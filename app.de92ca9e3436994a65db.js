var app=function(e){function t(t){for(var s,i,n=t[0],a=t[1],o=0,h=[];o<n.length;o++)i=n[o],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&h.push(r[i][0]),r[i]=0;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s]);for(c&&c(t);h.length;)h.shift()()}var s={},r={0:0};function i(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],s=r[e];if(0!==s)if(s)t.push(s[2]);else{var n=new Promise(function(t,i){s=r[e]=[t,i]});t.push(s[2]=n);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.src=function(e){return i.p+""+({}[e]||e)+".de92ca9e3436994a65db.js"}(e);var c=new Error;a=function(t){o.onerror=o.onload=null,clearTimeout(h);var s=r[e];if(0!==s){if(s){var i=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+n+")",c.name="ChunkLoadError",c.type=i,c.request=n,s[1](c)}r[e]=void 0}};var h=setTimeout(function(){a({type:"timeout",target:o})},12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(t)},i.m=e,i.c=s,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var n=window.webpackJsonp_name_=window.webpackJsonp_name_||[],a=n.push.bind(n);n.push=t,n=n.slice();for(var o=0;o<n.length;o++)t(n[o]);var c=a;return i(i.s=0)}([function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(138),n=s(139),a=s(202),o=s(209);function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),r.forEach(function(t){h(e,t,s[t])})}return e}function h(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const l={mainConfig:i,processorsPlugins:c({},r.contribProcessorsPlugins,n.default),components:c({},r.contribComponents,a.default),pluginHelpers:c({},o.default)};new r.Engine(l).start(),console.log("Hello! You can contact the author via email: mikhail.remmele@gmail.com")},function(e,t,s){"use strict";s.r(t);var r=s(2);s.d(t,"Engine",function(){return r.default});var i=s(30);s.d(t,"Processor",function(){return i.default});var n=s(31);s.d(t,"ProcessorPlugin",function(){return n.default});var a=s(32);s.d(t,"Component",function(){return a.default});var o=s(33);s.d(t,"Script",function(){return o.default});var c=s(34);s.d(t,"contribProcessorsPlugins",function(){return c.default});var h=s(115);s.d(t,"contribComponents",function(){return h.default});var l=s(5);s.d(t,"IOC",function(){return l.default});var u=s(50);s.d(t,"VectorOps",function(){return u.VectorOps}),s.d(t,"MathOps",function(){return u.MathOps}),s.d(t,"Vector2",function(){return u.Vector2});var d=s(10);s.d(t,"RESOURCES_LOADER_KEY_NAME",function(){return d.RESOURCES_LOADER_KEY_NAME}),s.d(t,"PROJECT_SETTINGS_KEY_NAME",function(){return d.PROJECT_SETTINGS_KEY_NAME})},function(e,t,s){"use strict";s.r(t);var r=s(3),i=s(5),n=s(7),a=s(8),o=s(16),c=s(22),h=s(26),l=s(28),u=s(10);t.default=class{constructor(e){const{GENERAL_SCOPE_NAME:t}=u;this.options=e,r.default.createScope(t),r.default.setCurrentScope(t)}async start(){const{SCENE_PROVIDER_KEY_NAME:e,RESOURCES_LOADER_KEY_NAME:t,PREFAB_COLLECTION_KEY_NAME:s,PROJECT_SETTINGS_KEY_NAME:r,GAME_OBJECT_CREATOR_KEY_NAME:d}=u,{mainConfig:_,processorsPlugins:g,components:f,pluginHelpers:m}=this.options,{projectSettings:p}=_;i.default.register(r,new n.default(p));const b=new o.default;i.default.register(t,new n.default(b));const v=new h.default(f);i.default.register(s,new n.default(v));const O=new c.default(f);i.default.register(d,new n.default(O));const y=new a.default(_.scenes,g,m);i.default.register(e,new n.default(y));for(let e=0;e<_.prefabs.length;e++){const t=await b.load(_.prefabs[e].src);v.register(t)}await y.loadScene(_.startScene),y.moveToLoaded();const w=new l.default;w.run(),window.onblur=(()=>w.stop()),window.onfocus=(()=>w.run())}}},function(e,t,s){"use strict";s.r(t);var r=s(4);const i=new class{constructor(){return this.instance||(this.instance=this,this.scopes={},this.currentScopeName=void 0,this.scopeChangeSubscribers=[]),this.instance}createScope(e){this.scopes[e]=new r.default}removeScope(e){this.scopes[e]=void 0}setCurrentScope(e){if(!this.scopes[e])throw new Error(`Error while setting new scope. Not found scope with same name: ${e}`);this.currentScopeName=e,this.scopeChangeSubscribers.forEach(e=>{e(this.scopes[this.currentScopeName])})}getCurrentScope(){if(!this.currentScopeName)throw new Error("Current scope is null");return this.scopes[this.currentScopeName]}subscribeOnScopeChange(e){if(!(e instanceof Function))throw new Error("On subscribe callback should be a function");this.scopeChangeSubscribers.push(e)}};Object.seal(i),t.default=i},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(){this.storage={}}resolve(e,t){if(!this.storage[e])throw new Error(`Resolution of dependency failed for key: ${e}`);return this.storage[e].resolve(t)}register(e,t){this.storage[e]=t}remove(e){this.storage[e]=void 0}}},function(e,t,s){"use strict";s.r(t);var r=s(3),i=s(6);const n=new class{constructor(){return this.instance||(this.instance=this),this.instance}resolve(e,...t){return r.default.getCurrentScope().resolve(e,t)}register(e,t){if(!(t instanceof i.default))throw new Error("Resolve dependency strategy should be inherits from ResolveDependencyStrategy");r.default.getCurrentScope().register(e,t)}remove(e){r.default.getCurrentScope().remove(e)}};Object.freeze(n),t.default=n},function(e,t,s){"use strict";s.r(t);t.default=class{resolve(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(6);t.default=class extends r.default{constructor(e){super(),this.instance=e}resolve(){return this.instance}}},function(e,t,s){"use strict";s.r(t);var r=s(5),i=s(9),n=s(14),a=s(15),o=s(10);t.default=class{constructor(e,t,s){this._sceneContainer={},this._currentSceneName=void 0,this._sceneChangeSubscribers=[],this._availableScenes=e,this._processorsPlugins=Object.keys(t).reduce((e,s)=>{const r=t[s];return e[s]=new r,e},{}),this._pluginHelpers=s,this._loadedScene=null,this._sceneController=new a.default(this)}async loadScene(e){if(!this._availableScenes[e])throw new Error(`Error while loading the scene. Not found scene with same name: ${e}`);this._loadedScene=void 0;const t=r.default.resolve(o.RESOURCES_LOADER_KEY_NAME),s=await t.load(this._availableScenes[e]),a=new i.default({name:s.name,gameObjects:s.gameObjects});for(let e=0;e<s.processors.length;e++){const{name:t,filter:r,options:i,section:o}=s.processors[e],c=new n.default(a,r),h=await this._processorsPlugins[t].load({...i,store:a.getStore(),gameObjectSpawner:a.getGameObjectSpawner(),gameObjectDestroyer:a.getGameObjectDestroyer(),gameObjectObserver:c,sceneController:this._sceneController,helpers:this._pluginHelpers});a.addProcessor(h,o)}this._loadedScene=a}isLoaded(){return!!this._loadedScene}moveToLoaded(){if(!this._loadedScene)return;this._sceneContainer[this._currentSceneName]&&this.leaveCurrentScene();const e=this._loadedScene.getName();this._sceneContainer[e]=this._loadedScene,this._loadedScene=void 0,this.setCurrentScene(e)}leaveCurrentScene(){if(!this._sceneContainer[this._currentSceneName])throw new Error("Error while leaving current scene. Current scene is null");this._sceneContainer[this._currentSceneName].unmount(),this._currentSceneName=void 0}removeScene(e){e===this._currentSceneName&&this.leaveCurrentScene(),this._sceneContainer[e]=void 0}setCurrentScene(e){if(!this._sceneContainer[e])throw new Error(`Error while setting new scene. Not found scene with same name: ${e}`);this._sceneContainer[this._currentSceneName]&&this._sceneContainer[this._currentSceneName].unmount(),this._currentSceneName=e,this._sceneContainer[this._currentSceneName].mount(),this._sceneChangeSubscribers.forEach(e=>{e(this._sceneContainer[this._currentSceneName])})}getCurrentScene(){if(!this._currentSceneName)throw new Error("Current scene is null");return this._sceneContainer[this._currentSceneName]}subscribeOnSceneChange(e){if(!(e instanceof Function))throw new Error("On subscribe callback should be a function");this._sceneChangeSubscribers.push(e)}}},function(e,t,s){"use strict";s.r(t);var r=s(10),i=s(5),n=s(11),a=s(12),o=s(13);const c="GAME_OBJECT_ADDED",h="GAME_OBJECT_REMOVED";t.default=class{constructor(e){const{name:t,gameObjects:s}=e;this._name=t,this._gameObjects={},this._store=new n.default,this._gameObjectCreator=i.default.resolve(r.GAME_OBJECT_CREATOR_KEY_NAME),this._gameObjectSpawner=new a.default(this,this._gameObjectCreator),this._gameObjectDestroyer=new o.default(this),this._processorSections={[r.SECTIONS.EVENT_PROCESS_SECTION_NAME]:[],[r.SECTIONS.GAME_STATE_UPDATE_SECTION_NAME]:[],[r.SECTIONS.RENDERING_SECTION_NAME]:[]},this._gameObjectsChangeSubscribers=[],this.GAME_OBJECT_ADDED=c,this.GAME_OBJECT_REMOVED=h,s.forEach(e=>{this._gameObjectCreator.create(e).forEach(e=>{this.addGameObject(e)})})}mount(){Object.keys(this._processorSections).forEach(e=>{this._processorSections[e].forEach(e=>{e.processorDidMount()})})}unmount(){Object.keys(this._processorSections).forEach(e=>{this._processorSections[e].forEach(e=>{e.processorWillUnmount()})})}addProcessor(e,t){this._processorSections[t].push(e)}getProcessorSection(e){return this._processorSections[e]}getStore(){return this._store}getGameObjectSpawner(){return this._gameObjectSpawner}getGameObjectDestroyer(){return this._gameObjectDestroyer}addGameObject(e){const t=e.getId();if(this._gameObjects[t])throw new Error(`The game object with same id already exists: ${t}`);this._gameObjects[t]=e,this._gameObjectsChangeSubscribers.forEach(t=>{t({type:c,gameObject:e})})}removeGameObject(e){e.clearSubscriptions(),this._gameObjects[e.getId()]=void 0,this._gameObjectsChangeSubscribers.forEach(t=>{t({type:h,gameObject:e})})}getName(){return this._name}getGameObjects(){return Object.values(this._gameObjects)}subscribeOnGameObjectsChange(e){if(!(e instanceof Function))throw new Error("On subscribe callback should be a function");this._gameObjectsChangeSubscribers.push(e)}}},function(e,t,s){"use strict";s.r(t),s.d(t,"GENERAL_SCOPE_NAME",function(){return r}),s.d(t,"PREFAB_COLLECTION_KEY_NAME",function(){return i}),s.d(t,"GAME_OBJECT_CREATOR_KEY_NAME",function(){return n}),s.d(t,"SCENE_PROVIDER_KEY_NAME",function(){return a}),s.d(t,"RESOURCES_LOADER_KEY_NAME",function(){return o}),s.d(t,"PROJECT_SETTINGS_KEY_NAME",function(){return c}),s.d(t,"SECTIONS",function(){return h});const r="general",i="prefabCollection",n="gameObjectCreator",a="sceneProvider",o="resourcesLoader",c="projectSettings",h={EVENT_PROCESS_SECTION_NAME:"eventProcessSection",GAME_STATE_UPDATE_SECTION_NAME:"gameStateUpdateSection",RENDERING_SECTION_NAME:"renderingSection"}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(){this._store={}}set(e,t){this._store[e]=t}get(e){return this._store[e]}has(e){return!!this._store[e]}delete(e){const t=this.has(e);return this._store[e]=void 0,t}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e,t){this._scene=e,this._gameObjectCreator=t}spawn(e){const t=this._gameObjectCreator.create({prefabName:e,fromPrefab:!0,isNew:!0});return t.forEach(e=>{this._scene.addGameObject(e)}),t[0]}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e){this._scene=e}destroy(e){e.getChildren().forEach(e=>{this._scene.removeGameObject(e)}),this._scene.removeGameObject(e)}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e,t){const{type:s,components:r=[]}=t;this._components=r,this._type=s,this._observedGameObjects=e.getGameObjects(),this._addedToAccepted=[],this._removedFromAccepted=[],this._acceptedGameObjectsMap={},this._acceptedGameObjects=this._observedGameObjects.filter(e=>(e.subscribe(this._subscribeGameObject.bind(this)),!!this._test(e)&&(this._acceptedGameObjectsMap[e.getId()]=e,this._addedToAccepted.push(e),!0))),e.subscribeOnGameObjectsChange(t=>{const s=t.gameObject;e.GAME_OBJECT_ADDED===t.type?(s.subscribe(this._subscribeGameObject.bind(this)),this._add(s)):this._remove(s)})}_subscribeGameObject(e){const t=e.gameObject;this._test(t)?this._accept(t):this._decline(t)}_add(e){this._observedGameObjects.push(e),this._test(e)&&this._accept(e)}_remove(e){const t=e=>e.filter(e=>s!==e.getId()),s=e.getId();this._observedGameObjects=t(this._observedGameObjects),this._acceptedGameObjects=t(this._acceptedGameObjects),this._acceptedGameObjectsMap[s]=void 0,this._removedFromAccepted.push(e)}_test(e){const t=e.getType();return(!this._type||this._type===t)&&this._components.every(t=>e.getComponent(t))}_accept(e){const t=e.getId();this._acceptedGameObjectsMap[t]||(this._acceptedGameObjects.push(e),this._acceptedGameObjectsMap[t]=e,this._addedToAccepted.push(e))}_decline(e){const t=e.getId();this._acceptedGameObjectsMap[t]&&(this._acceptedGameObjects=this._acceptedGameObjects.filter(e=>t!==e.getId()),this._acceptedGameObjectsMap[t]=void 0,this._removedFromAccepted.push(e))}size(){return this._acceptedGameObjects.length}getLastRemoved(){const e=this._removedFromAccepted;return this._removedFromAccepted=[],e}getLastAdded(){const e=this._addedToAccepted;return this._addedToAccepted=[],e}getById(e){return this._acceptedGameObjectsMap[e]}getByIndex(e){return this._acceptedGameObjects[e]}forEach(e){this._acceptedGameObjects.forEach(e)}map(e){return this._acceptedGameObjects.map(e)}sort(e){this._acceptedGameObjects=this._acceptedGameObjects.sort(e)}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e){this._sceneProvider=e}getCurrentName(){return this._sceneProvider.getCurrentScene().getName()}load(e){this._sceneProvider.loadScene(e)}isLoaded(){return this._sceneProvider.isLoaded()}moveToLoaded(){this._sceneProvider.moveToLoaded()}moveTo(e){this._sceneProvider.setCurrentScene(e)}}},function(e,t,s){"use strict";s.r(t);var r=s(17);t.default=class{constructor(){this.resourceLoaderQualifier=new r.default}load(e){return this.resourceLoaderQualifier.getLoader(e).load(e)}}},function(e,t,s){"use strict";s.r(t);var r=s(18);const i=".";t.default=class{constructor(){this.loaders=Object.keys(r.default).map(e=>new(0,r.default[e]))}_getResourceExt(e){return`${i}${e.split(i).pop()}`}getLoader(e){const t=this._getResourceExt(e);return this.loaders.find(e=>e.getSupportedExtensions().includes(t))}}},function(e,t,s){"use strict";s.r(t);var r=s(19),i=s(21);t.default={imageLoader:r.default,jsonLoader:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(20);t.default=class extends r.default{constructor(){super(),this._supportedExtensions=[".png"]}getSupportedExtensions(){return this._supportedExtensions}load(e){return new Promise((t,s)=>{const r=new Image;r.src=e,r.onload=(()=>{t(r)}),r.onerror=(()=>{s(new Error("Failed to load image"))})})}}},function(e,t,s){"use strict";s.r(t);t.default=class{getSupportedExtensions(){throw new Error("You should override this function")}load(){Promise.reject(new Error("You should override this function"))}}},function(e,t,s){"use strict";s.r(t);var r=s(20);t.default=class extends r.default{constructor(){super(),this._supportedExtensions=[".json"]}getSupportedExtensions(){return this._supportedExtensions}load(e){return fetch(e).then(e=>e.json()).catch(e=>new Error(`Failed to load json: ${e.message}`))}}},function(e,t,s){"use strict";s.r(t);var r=s(23),i=s.n(r),n=s(5),a=s(25),o=s(10);t.default=class{constructor(e){this._components=e,this._prefabCollection=n.default.resolve(o.PREFAB_COLLECTION_KEY_NAME)}_buildFromPrefab(e,t){const{type:s,prefabName:r,components:n=[],children:o=[],isNew:c=!1}=e;let{id:h,name:l}=e;if(h=h||i()(),l=l||h,!t)throw new Error(`Can't create game object ${l} from prefab. `+`The prefab ${r} is null.`);const u=new a.default(h);if(u.setType(s||t.getType()),c)t.getChildren().forEach(e=>{const{name:t}=e,s={prefabName:t,fromPrefab:!0,isNew:c},r=this._build(s,e);r.setParent(u),u.appendChild(r)});else{const e=t.getChildren().reduce((e,t)=>(e[t.getName()]=t,e),{});o.forEach(t=>{const{prefabName:s,fromPrefab:r}=t,i=r?e[s]:void 0,n=this._build(t,i);n.setParent(u),u.appendChild(n)})}return t.getAvailableComponents().forEach(e=>{u.setComponent(e,t.getComponent(e))}),n.forEach(e=>{const t=this._components[e.name];u.setComponent(e.name,new t(e.config))}),u}_buildFromScratch(e){const{type:t,components:s=[],children:r=[]}=e;let{id:n}=e;n=n||i()();const o=new a.default(n);return o.setType(t),r.forEach(e=>{const t=this._build(e);t.setParent(o),o.appendChild(t)}),s.forEach(e=>{const t=this._components[e.name];o.setComponent(e.name,new t(e.config))}),o}_build(e,t){const{prefabName:s,fromPrefab:r}=e;return r?(t=t||this._prefabCollection.get(s),this._buildFromPrefab(e,t)):this._buildFromScratch(e)}_expandGameObject(e,t){return(t=t||[]).push(e),e.getChildren().forEach(e=>{this._expandGameObject(e,t)}),t}create(e){return this._expandGameObject(this._build(e))}}},function(e,t,s){"use strict";!function(){var t,r,i,n=0,a=[];for(h.BUFFER_SIZE=512,h.bin=c,h.test=function(e){if("string"==typeof e)return/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(e)},r=0;r<256;r++)a[r]=(r+256).toString(16).substr(1);function o(e,t){return Math.floor(Math.random()*(t-e))+e}function c(){var e=function(e){var s;if(void 0!==i){if(void 0===t||n+e>h.BUFFER_SIZE)if(n=0,i.getRandomValues)t=new Uint8Array(h.BUFFER_SIZE),i.getRandomValues(t);else{if(!i.randomBytes)throw new Error("Non-standard crypto library");t=i.randomBytes(h.BUFFER_SIZE)}return t.slice(n,n+=e)}for(s=[],r=0;r<e;r++)s.push(o(0,255));return s}(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e}function h(){var e=c();return a[e[0]]+a[e[1]]+a[e[2]]+a[e[3]]+"-"+a[e[4]]+a[e[5]]+"-"+a[e[6]]+a[e[7]]+"-"+a[e[8]]+a[e[9]]+"-"+a[e[10]]+a[e[11]]+a[e[12]]+a[e[13]]+a[e[14]]+a[e[15]]}"undefined"!=typeof crypto?i=crypto:"undefined"!=typeof window&&void 0!==window.msCrypto&&(i=window.msCrypto),i=i||s(24),e.exports=h}()},function(e,t){},function(e,t,s){"use strict";s.r(t);const r="COMPONENT_ADDED",i="COMPONENT_REMOVED";t.default=class{constructor(e){this._id=e,this._components={},this._parent=null,this._children=[],this._type=null,this._subscribers=[],this.COMPONENT_ADDED=r,this.COMPONENT_REMOVED=i}setParent(e){this._parent=e}getParent(){return this._parent}getAncestor(){const e=t=>{const s=t.getParent();return s?e(s):t};return e(this)}appendChild(e){this._children.push(e)}getChildren(){return this._children}getId(){return this._id}getComponentNamesList(){return Object.keys(this._components)}getComponent(e){return this._components[e]}setComponent(e,t){this._components[e]=t,this._parent&&this._parent.getComponent(e)&&(t.parent=this._parent.getComponent(e)),this._children.forEach(s=>{s.getComponent(e)&&(s.getComponent(e).parent=t)}),this._subscribers.forEach(t=>{t({type:r,componentName:e,gameObject:this})})}removeComponent(e){this._components[e]=void 0,this._children.forEach(t=>{t.getComponent(e)&&(t.getComponent(e).parent=void 0)}),this._subscribers.forEach(t=>{t({type:i,componentName:e,gameObject:this})})}getType(){return this._type}setType(e){this._type=e}subscribe(e){if(!(e instanceof Function))throw new Error("On subscribe callback should be a function");this._subscribers.push(e)}clearSubscriptions(){this._subscribers=[]}}},function(e,t,s){"use strict";s.r(t);var r=s(27);t.default=class{constructor(e){this._components=e,this._storage={}}_buildPrefab(e){const{name:t,type:s,components:i=[],children:n=[]}=e,a=new r.default;return a.setName(t),a.setType(s),n.forEach(e=>{const t=this._buildPrefab(e);t.setParent(a),a.appendChild(t)}),i.forEach(e=>{const t=this._components[e.name];a.setComponent(e.name,new t(e.config))}),a}register(e){this._storage[e.name]=this._buildPrefab(e)}get(e){if(!this._storage[e])throw new Error(`Can't find prefab with same name: ${e}`);return this._storage[e].clone()}}},function(e,t,s){"use strict";s.r(t);class r{constructor(){this._name=null,this._components={},this._parent=null,this._children=[],this._type=null}setName(e){this._name=e}getName(){return this._name}setParent(e){this._parent=e}getParent(){return this._parent}appendChild(e){this._children.push(e)}getChildren(){return this._children}setComponent(e,t){this._components[e]=t}getComponent(e){if(!this._components[e])throw new Error(`Can't find component with the following name: ${e}`);return this._components[e]}getAvailableComponents(){return Object.keys(this._components)}setType(e){this._type=e}getType(){return this._type}clone(){const e=new r;return e.setName(this._name),e.setType(this._type),this._children.forEach(t=>{const s=t.clone();s.setParent(e),e.appendChild(s)}),Object.keys(this._components).forEach(t=>{e.setComponent(t,this._components[t].clone())}),e}}t.default=r},function(e,t,s){"use strict";s.r(t);var r=s(5),i=s(29),n=s(10);const a=1e3/60;t.default=class{constructor(){this.gameLoopId=null,this.sceneProvider=r.default.resolve(n.SCENE_PROVIDER_KEY_NAME),this.messageBus=new i.default}_processSection(e,t){const s=this.sceneProvider.getCurrentScene().getProcessorSection(e);t={...t||{},messageBus:this.messageBus},s.forEach(e=>{e.process(t)})}_gameStateUpdate(){if(this.lag<a)this.messageBus.stash();else{for(;this.lag>=a;)this._processSection(n.SECTIONS.GAME_STATE_UPDATE_SECTION_NAME,{deltaTime:a}),this.lag-=a,this.lag>=a&&(this.messageBus.stash(),this.messageBus.sendDelayed());this.messageBus.restore()}}run(){this.previous=void 0,this.lag=a;const e=this;this.gameLoopId=requestAnimationFrame(function t(s){e.previous=e.previous||s;const r=s-e.previous;e.previous=s,e.lag+=r,e.messageBus.restore(),e.messageBus.sendDelayed(),e._processSection(n.SECTIONS.EVENT_PROCESS_SECTION_NAME),e._gameStateUpdate(),e._processSection(n.SECTIONS.RENDERING_SECTION_NAME,{deltaTime:r}),e.messageBus.clear(),e.gameLoopId=requestAnimationFrame(t)})}stop(){this.gameLoopId&&cancelAnimationFrame(this.gameLoopId)}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(){this._messages={},this._stashedMessages=[],this._delayedMessages=[]}send(e,t=!1){if(!e.type)throw new Error("Can't send the message without specified type");if(t)return void this._delayedMessages.push(e);const{type:s,id:r}=e;this._messages[s]=this._messages[s]||{array:[],map:{}},r&&(this._messages[s].map[r]=this._messages[s].map[r]||[],this._messages[s].map[r].push(e)),this._messages[s].array.push(e)}get(e){return this._messages[e]?this._messages[e].array:void 0}getById(e,t){return this._messages[e]?this._messages[e].map[t]:void 0}delete(e){this._messages[e]=void 0}deleteById(e,t){const s=this.getById(e,t);s&&(this._messages[e].array=this._messages[e].array.filter(e=>!s.includes(e)),this._messages[e].map[t]=void 0)}stash(){this._stashedMessages.push(this._messages),this._messages={}}restore(){0!==this._stashedMessages.length&&(this._stashedMessages.push(this._messages),this._messages=this._stashedMessages.reduce((e,t)=>(Object.keys(t).forEach(s=>{t[s]&&(e[s]=e[s]||{array:[],map:{}},e[s].array=e[s].array.concat(t[s].array),e[s].map=Object.keys(t[s].map).reduce((e,r)=>(e[r]?e[r]=e[r].concat(t[s].map[r]):e[r]=t[s].map[r],e),e[s].map))}),e),{}),this._stashedMessages=[])}sendDelayed(){this._delayedMessages.length&&(this._delayedMessages.forEach(e=>{this.send(e)}),this._delayedMessages=[])}clear(){this._messages={}}reset(){this._messages={},this._stashedMessages=[],this._delayedMessages=[]}}},function(e,t,s){"use strict";s.r(t);t.default=class{processorDidMount(){}processorWillUnmount(){}process(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);t.default=class{async load(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);t.default=class{set parent(e){this._parent=e}get parent(){return this._parent}clone(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e,t,s,r){this.gameObject=e,this.store=t,this.spawner=s,this.destroyer=r}update(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(35),i=s(41),n=s(43),a=s(46),o=s(67),c=s(69),h=s(71),l=s(73),u=s(78),d=s(80),_=s(82),g=s(85),f=s(87),m=s(89),p=s(91),b=s(107),v=s(109),O=s(111);t.default={animateProcessor:r.default,cameraProcessor:i.default,collisionBroadcastProcessor:n.default,collisionDetectionProcessor:a.default,collisionSolver:o.default,constraintSolver:c.default,jammer:h.default,keyboardInputProcessor:l.default,keyboardControlProcessor:u.default,mouseControlProcessor:d.default,mouseInputProcessor:_.default,mouseInputCoordinatesProjector:g.default,movementProcessor:f.default,physicsProcessor:m.default,renderProcessor:p.default,sceneLoadProcessor:b.default,scriptProcessor:v.default,uiBridge:O.default}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(36);t.default=class extends r.default{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(37);const n=100,a="renderable",o="animatable";t.default=class extends r.default{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._conditionControllers=Object.keys(i.default).reduce((e,t)=>{const s=i.default[t];return e[t]=new s,e},{})}_setFrame(e,t){e.currentFrame=t.index,e.rotation=void 0!==t.rotation?t.rotation:e.rotation,e.flipX=void 0!==t.flipX?t.flipX:e.flipX,e.flipY=void 0!==t.flipY?t.flipY:e.flipY,e.disabled=t.disabled}process(e){const t=e.deltaTime,s=e.messageBus;this._gameObjectObserver.forEach(e=>{const r=e.getComponent(a),i=e.getComponent(o),c=i.currentState.transitions.find(t=>t.conditions.every(t=>this._conditionControllers[t.type].check(t.props,e,s)));if(c){const e=i.currentState.name;i.currentState=c.state,i.currentState.previousState=e,i.duration=0}const h=i.currentState.frames,l=h.length,u=i.currentState.speed,d=n/u,_=l*d;if(i.duration+=t,i.duration>=_){if(!i.currentState.looped)return i.currentState=i.currentState.fallbackState?i.currentState.fallbackState:i.currentState.previousState||i.defaultState,i.duration=0,void this._setFrame(r,i.currentState.frames[0]);i.duration%=_}this._setFrame(r,h[Math.trunc(i.duration/d)])})}}},function(e,t,s){"use strict";s.r(t);var r=s(38),i=s(40);t.default={message:r.default,comparator:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(39);t.default=class extends r.default{check(e,t,s){const{message:r}=e;return(s.get(r)||[]).some(e=>e.gameObject.getId()===t.getId())}}},function(e,t,s){"use strict";s.r(t);t.default=class{check(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(39);t.default=class extends r.default{constructor(){super(),this._getters={number:e=>{if("number"!=typeof e)throw new Error("The value must be a number");return e},componentValue:(e,t)=>{const s=e[0];let r=t.getComponent(s);for(let t=1;t<e.length&&void 0!==r;t++)r=r[e[t]];return r}},this._operations={equals:(e,t)=>e===t,notEquals:(e,t)=>e!==t,greater:(e,t)=>e>t,less:(e,t)=>e<t}}_getValue(e,t){if(!this._getters[e.type])throw new Error(`Unknown value type: ${e.type}`);return this._getters[e.type](e.value,t)}check(e,t){const{operation:s}=e;if(!this._operations[s])throw new Error(`Unknown operation type: ${s}`);const r=this._getValue(e.arg1,t),i=this._getValue(e.arg2,t);return this._operations[s](r,i)}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(42);t.default=class extends r.default{async load(e){const{initialCamera:t,windowNodeId:s,gameObjectObserver:r,store:n}=e,a=document.getElementById(s);return new i.default({initialCamera:t,window:a,gameObjectObserver:r,store:n})}}},function(e,t,s){"use strict";s.r(t);var r=s(30);const i="currentCamera",n="SET_CAMERA",a="camera";t.default=class extends r.default{constructor(e){super();const{store:t,gameObjectObserver:s,window:r,initialCamera:i}=e;this._gameObjectObserver=s,this._store=t,this._window=r;const n=this._gameObjectObserver.getById(i);if(!n)throw new Error(`Could not set camera with id ${i} for the scene`);this._setCamera(n)}_updateCameraWindowSize(e){const t=e.getComponent(a),{windowSizeX:s,windowSizeY:r}=t,i=this._window.width/window.devicePixelRatio,n=this._window.height/window.devicePixelRatio;i===s&&n===r||(t.windowSizeX=i,t.windowSizeY=n)}_setCamera(e){this._updateCameraWindowSize(e),this._store.set(i,e)}process(e){const t=e.messageBus.get(n);if(t){const{gameObjectId:e}=t[t.length-1],s=this._gameObjectObserver.getById(e);if(!s)throw new Error(`Could not set camera with id ${e} for the scene`);this._setCamera(s)}this._updateCameraWindowSize(this._store.get(i))}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(44);t.default=class extends r.default{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(45);const n="COLLISION";t.default=class extends r.default{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._collisionMap={},this._activeCollisions=[]}_publishMessage(e,t){const{gameObject1:s,gameObject2:r,mtv1:i,mtv2:a}=e,o={type:`${n}_${e.getState()}`,id:s.getId(),gameObject1:s,gameObject2:r,mtv1:i,mtv2:a};t.send(o),t.send(o,!0)}_processRemovedGameObjects(e){this._gameObjectObserver.getLastRemoved().forEach(t=>{const s=t.getId();this._activeCollisions=this._activeCollisions.filter(t=>t.gameObject1.getId()!==s&&t.gameObject2.getId()!==s||(t.gameObject2.getId()===s&&(this._collisionMap[t.gameObject1.getId()][s]=null),t.tick(),this._publishMessage(t,e),!1)),this._collisionMap[s]=null})}process(e){const{messageBus:t}=e;this._processRemovedGameObjects(t),(t.get(n)||[]).forEach(e=>{const{gameObject1:t,gameObject2:s,mtv1:r,mtv2:n}=e,a=t.getId(),o=s.getId();if(this._collisionMap[a]=this._collisionMap[a]||{},this._collisionMap[a][o])this._collisionMap[a][o].mtv1=r,this._collisionMap[a][o].mtv2=n,this._collisionMap[a][o].signal();else{const e=new i.default(t,s,r,n);this._collisionMap[a][o]=e,this._activeCollisions.push(e)}}),this._activeCollisions=this._activeCollisions.filter(e=>{const{gameObject1:s,gameObject2:r}=e;return this._publishMessage(e,t),e.tick(),e.isFinished()&&(this._collisionMap[s.getId()][r.getId()]=null),!e.isFinished()})}}},function(e,t,s){"use strict";s.r(t);const r={2:"ENTER",1:"STAY",0:"LEAVE"};t.default=class{constructor(e,t,s,r){this._gameObject1=e,this._gameObject2=t,this._lifetime=2,this._mtv1=s,this._mtv2=r}set gameObject1(e){this._gameObject1=e}get gameObject1(){return this._gameObject1}set gameObject2(e){this._gameObject2=e}get gameObject2(){return this._gameObject2}set mtv1(e){this._mtv1=e}get mtv1(){return this._mtv1}set mtv2(e){this._mtv2=e}get mtv2(){return this._mtv2}isFinished(){return this._lifetime<0}signal(){this._lifetime=1}tick(){this._lifetime-=this._lifetime||1}getState(){return r[this._lifetime]}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(47);t.default=class extends r.default{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(48),n=s(56),a=s(61),o=s(66);const c="colliderContainer",h="transform",l={X:"x",Y:"y"},u="COLLISION";t.default=class extends r.default{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._coordintatesCalculators=Object.keys(i.default).reduce((e,t)=>{const s=i.default[t];return e[t]=new s,e},{}),this._aabbBuilders=Object.keys(n.default).reduce((e,t)=>{const s=n.default[t];return e[t]=new s,e},{}),this._intersectionCheckers=Object.keys(a.default).reduce((e,t)=>{const s=a.default[t];return e[t]=new s,e},{}),this._axis={[l.X]:{sortedList:[],dispersionCalculator:new o.default},[l.Y]:{sortedList:[],dispersionCalculator:new o.default}},this._lastProcessedGameObjects={}}_checkOnReorientation(e){const t=e.getId();if(!this._lastProcessedGameObjects[t])return!0;const s=this._lastProcessedGameObjects[t],r=e.getComponent(h);return r.offsetX!==s.offsetX||r.offsetY!==s.offsetY}_addToAxisSortedList(e,t){[e.aabb.min[t],e.aabb.max[t]].forEach(s=>{this._axis[t].sortedList.push({[t]:s,entry:e})})}_updateAxisSortedList(e,t){const{gameObject:s,aabb:r,coordinates:i}=e,n=s.getId(),a=[r.min[t],r.max[t]],o=this._axis[t].sortedList;for(let e=0;e<o.length&&(n!==o[e].entry.gameObject.getId()||(o[e][t]=a.shift(),o[e].entry.aabb=r,o[e].entry.coordinates=i,a.length));e++);}_removeFromSortedList(e,t){const s=e.getId();this._axis[t].sortedList=this._axis[t].sortedList.filter(e=>s!==e.entry.gameObject.getId())}_getSortingAxis(){return this._axis[l.X].dispersionCalculator.getDispersion()>=this._axis[l.Y].dispersionCalculator.getDispersion()?l.X:l.Y}_sweepAndPrune(e){const t=this._axis[e].sortedList,s=Object.values(l).filter(t=>e!==t);t.sort((t,s)=>t[e]>s[e]?1:t[e]<s[e]?-1:0);let r=t.reduce((e,t)=>{const s=t.entry;return e.activeEntries.has(s)?e.activeEntries.delete(s):(e.activeEntries.forEach(t=>{e.collisions.push([s,t])}),e.activeEntries.add(s)),e},{collisions:[],activeEntries:new Set}).collisions;return s.forEach(e=>{r=r.filter(t=>{const s=t[0].aabb,r=t[1].aabb;return s.max[e]>r.min[e]&&s.min[e]<r.max[e]})}),r}_checkOnIntersection(e){const t=e=>{const t=e.gameObject.getComponent(c);return{colliderType:t.type,collider:t.collider,coordinates:e.coordinates}},s=t(e[0]),r=t(e[1]),i=`${s.colliderType}_${r.colliderType}`;return this._intersectionCheckers[i].check(s,r)}_sendCollisionMessage(e,t,s,r){const{mtv1:i,mtv2:n}=r;[{gameObject1:t,gameObject2:s,mtv1:i,mtv2:n},{gameObject1:s,gameObject2:t,mtv1:n,mtv2:i}].forEach(t=>{e.send({type:u,gameObject1:t.gameObject1,gameObject2:t.gameObject2,mtv1:t.mtv1,mtv2:t.mtv2})})}process(e){const t=e.messageBus;this._gameObjectObserver.getLastRemoved().forEach(e=>{const t=e.getId();Object.values(l).forEach(s=>{this._axis[s].dispersionCalculator.removeFromSample(t),this._removeFromSortedList(e,s)}),this._lastProcessedGameObjects[t]=null}),this._gameObjectObserver.forEach(e=>{if(!this._checkOnReorientation(e))return;const t=e.getId(),s=e.getComponent(h),r=e.getComponent(c),i=this._coordintatesCalculators[r.type].calc(r.collider,s),n=this._aabbBuilders[r.type].getAABB(r.collider,i);Object.values(l).forEach(s=>{const r=.5*(n.min[s]+n.max[s]);this._axis[s].dispersionCalculator.addToSample(t,r);const a={gameObject:e,aabb:n,coordinates:i};this._lastProcessedGameObjects[t]?this._updateAxisSortedList(a,s):this._addToAxisSortedList(a,s)}),this._lastProcessedGameObjects[t]=s.clone()}),this._sweepAndPrune(this._getSortingAxis()).forEach(e=>{const s=this._checkOnIntersection(e);s&&this._sendCollisionMessage(t,e[0].gameObject,e[1].gameObject,s)})}}},function(e,t,s){"use strict";s.r(t);var r=s(49),i=s(55);t.default={boxCollider:r.default,circleCollider:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(50),i=s(54);t.default=class extends i.default{calc(e,t){const{offsetX:s,offsetY:i}=t;let{centerX:n,centerY:a}=e;const{sizeX:o,sizeY:c}=e,h=-o/2+(n+=s),l=o/2+n,u=-c/2+(a+=i),d=c/2+a,_=[{x:h,y:u},{x:h,y:d},{x:l,y:d},{x:l,y:u}];return{center:{x:n,y:a},points:_,edges:_.map((e,t,s)=>{const i=s[(t+1)%s.length];return{point1:e,point2:i,normal:r.VectorOps.getNormal(e.x,i.x,e.y,i.y)}})}}}},function(e,t,s){"use strict";s.r(t);var r=s(51);s.d(t,"Vector2",function(){return r.Vector2});var i=s(52);s.d(t,"VectorOps",function(){return i.VectorOps});var n=s(53);s.d(t,"MathOps",function(){return n.MathOps})},function(e,t,s){"use strict";s.r(t),s.d(t,"Vector2",function(){return r});class r{constructor(e,t){this._x=e,this._y=t}set x(e){this._x=e}get x(){return this._x}set y(e){this._y=e}get y(){return this._y}get magnitude(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}add(e){this._x+=e.x,this._y+=e.y}multiplyNumber(e){this._x*=e,this._y*=e}equals(e){return this._x===e.x&&this._y===e.y}clone(){return new r(this._x,this._y)}}},function(e,t,s){"use strict";s.r(t),s.d(t,"VectorOps",function(){return i});var r=s(51);class i{static fixCalcError(e){return Math.abs(e)<Number.EPSILON?0:e}static getVectorByAngle(e){const t=this.fixCalcError(Math.cos(e)),s=this.fixCalcError(Math.sin(e));return new r.Vector2(t,s)}static getNormal(e,t,s,i){const n=new r.Vector2(s-i,t-e);return n.multiplyNumber(1/n.magnitude),n}static dotProduct(e,t){return e.x*t.x+e.y*t.y}}},function(e,t,s){"use strict";s.r(t),s.d(t,"MathOps",function(){return r});class r{static random(e,t){return Math.floor(e+Math.random()*(t+1-e))}static radToDeg(e){const t=180*e/Math.PI;return t<0?t+360:t}static degToRad(e){return e*Math.PI/180}static getAngleBetweenTwoPoints(e,t,s,r){return Math.atan2(s-r,e-t)}static getDistanceBetweenTwoPoints(e,t,s,r){return Math.sqrt(Math.pow(t-e,2)+Math.pow(r-s,2))}static getLinePoint(e,t,s,r){const i=this.degToRad(e);return{x:t-r*Math.cos(i),y:s-r*Math.sin(i)}}static clamp(e,t,s){return e<t?t:e>s?s:e}}},function(e,t,s){"use strict";s.r(t);t.default=class{calc(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(54);t.default=class extends r.default{calc(e,t){const{offsetX:s,offsetY:r}=t,{centerX:i,centerY:n}=e;return{center:{x:i+s,y:n+r},points:[],edges:[]}}}},function(e,t,s){"use strict";s.r(t);var r=s(57),i=s(60);t.default={boxCollider:r.default,circleCollider:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(58),i=s(59);t.default=class extends r.default{getAABB(e,t){const s=t.points.reduce((e,t)=>{const s=e.min.x,r=e.min.y,i=e.max.x,n=e.max.y;return e.min.x=null===s||t.x<s?t.x:s,e.min.y=null===r||t.y<r?t.y:r,e.max.x=null===i||t.x>i?t.x:i,e.max.y=null===n||t.y>n?t.y:n,e},{min:{x:null,y:null},max:{x:null,y:null}});return new i.default({x:s.min.x,y:s.min.y},{x:s.max.x,y:s.max.y})}}},function(e,t,s){"use strict";s.r(t);t.default=class{getAABB(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e,t){this._min=e,this._max=t}set min(e){this._min=e}get min(){return this._min}set max(e){this._max=e}get max(){return this._max}}},function(e,t,s){"use strict";s.r(t);var r=s(58),i=s(59);t.default=class extends r.default{getAABB(e,t){const{radius:s}=e,{x:r,y:n}=t.center,a=r-s,o=r+s,c=n-s,h=n+s;return new i.default({x:a,y:c},{x:o,y:h})}}},function(e,t,s){"use strict";s.r(t);var r=s(62),i=s(64),n=s(65);t.default={boxCollider_boxCollider:r.default,circleCollider_circleCollider:i.default,circleCollider_boxCollider:n.default,boxCollider_circleCollider:n.default}},function(e,t,s){"use strict";s.r(t);var r=s(50),i=s(63);t.default=class extends i.default{_projectPolygon(e,t){const s=r.VectorOps.dotProduct(e.edges[0].point1,t),i={min:s,max:s};for(let s=1;s<e.edges.length;s++){const n=r.VectorOps.dotProduct(e.edges[s].point1,t);n<i.min?i.min=n:n>i.max&&(i.max=n)}return i}check(e,t){let s,i;const{x:n,y:a}=e.coordinates.center,{x:o,y:c}=t.coordinates.center;for(let r=0;r<e.coordinates.edges.length/2;r++){const n=e.coordinates.edges[r].normal,a=this._projectPolygon(e.coordinates,n),o=this._projectPolygon(t.coordinates,n),c=a.min-o.max,h=o.min-a.max;if(c>0||h>0)return!1;const l=Math.abs(c),u=Math.abs(h);(void 0===s||l<s)&&(s=l,i=n),(void 0===s||u<s)&&(s=u,i=n)}const h=i.clone();h.multiplyNumber(s);const l=Math.abs(h.x),u=-Math.abs(h.x),d=Math.abs(h.y),_=-Math.abs(h.y);return{mtv1:new r.Vector2(n<o?u:l,a<c?_:d),mtv2:new r.Vector2(o>n?l:u,c>a?d:_)}}}},function(e,t,s){"use strict";s.r(t);t.default=class{check(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(50),i=s(63);t.default=class extends i.default{check(e,t){const{radius:s}=e.collider,{radius:i}=t.collider,{x:n,y:a}=e.coordinates.center,{x:o,y:c}=t.coordinates.center,h=n-o,l=a-c,u=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));if(u>=s+i)return!1;if(0===u)return{mtv1:new r.Vector2(s+i,0),mtv2:new r.Vector2(-(s+i),0)};const d=new r.Vector2(h,l),_=s+i-u;d.multiplyNumber(1/u*_);const g=Math.abs(d.x),f=-Math.abs(d.x),m=Math.abs(d.y),p=-Math.abs(d.y);return{mtv1:new r.Vector2(n<o?f:g,a<c?p:m),mtv2:new r.Vector2(o<n?f:g,c<a?p:m)}}}},function(e,t,s){"use strict";s.r(t);var r=s(50),i=s(63);t.default=class extends i.default{check(e,t){let s,i;e.coordinates.points.length?(s=e,i=t):(s=t,i=e);const{x:n,y:a}=e.coordinates.center,{x:o,y:c}=t.coordinates.center,{radius:h}=i.collider,{x:l,y:u}=i.coordinates.center,{sizeX:d,sizeY:_}=s.collider,{x:g,y:f}=s.coordinates.center,m=g-d/2,p=g+d/2,b=f-_/2,v=f+_/2,O=(e,t)=>{e.multiplyNumber(1/e.magnitude*t);const s=Math.abs(e.x),i=-Math.abs(e.x),h=Math.abs(e.y),l=-Math.abs(e.y);return{mtv1:new r.Vector2(n<o?i:s,a<c?l:h),mtv2:new r.Vector2(o>n?s:i,c>a?h:l)}};let y,w;if(l>m&&l<p&&u>b&&u<v){const e=Math.abs(l-m),t=Math.abs(l-p),s=Math.min(e,t),i=Math.abs(u-b),n=Math.abs(u-v),a=Math.min(i,n);y=e<t?m:p,w=i<n?b:v,s<a?w=u:y=l;const o=r.MathOps.getDistanceBetweenTwoPoints(l,y,u,w);return O(new r.Vector2(y-l,w-u),h+o)}{y=r.MathOps.clamp(l,m,p),w=r.MathOps.clamp(u,b,v);const e=r.MathOps.getDistanceBetweenTwoPoints(l,y,u,w);return!(e>=h)&&O(0!==e?new r.Vector2(y-l,w-u):new r.Vector2(l===m||l===p?g-l:0,u===b||u===v?f-u:0),h-e)}}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(){this._sample={},this._sampleSize=0,this._sum=0,this._squaredSum=0}addToSample(e,t){this.removeFromSample(e),this._sum+=t,this._squaredSum+=Math.pow(t,2),this._sample[e]=t,this._sampleSize+=1}removeFromSample(e){this._sample[e]&&(this._sum-=this._sample[e],this._squaredSum-=Math.pow(this._sample[e],2),this._sample[e]=null,this._sampleSize-=1)}getDispersion(){return this._squaredSum/this._sampleSize-Math.pow(this._sum/this._sampleSize,2)}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(68);t.default=class extends r.default{async load(e){const{gameObjectObserver:t,store:s}=e;return new i.default({gameObjectObserver:t,store:s})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(50);const n="ADD_FORCE",a="STOP_MOVEMENT",o="COLLISION_ENTER",c="COLLISION_STAY",h="rigidBody",l="reactionForce",u="gravitationalAcceleration",d=0,_=-1;t.default=class extends r.default{constructor(e){super();const{gameObjectObserver:t,store:s}=e;this._store=s,this._gameObjectObserver=t}processorDidMount(){this._gravitationalAcceleration=this._store.get(u)}_addReactionForce(e,t,s){const r=e.getComponent(h),{useGravity:o,mass:c}=r;if(o&&t.y&&-1===Math.sign(t.y)&&!t.x){const t=new i.Vector2(d,_);t.multiplyNumber(c*this._gravitationalAcceleration),s.send({type:n,name:l,value:t,gameObject:e,id:e.getId()},!0),s.send({type:a,gameObject:e,id:e.getId()},!0)}}_validateCollision(e,t){const s=e.getComponent(h),r=t.getComponent(h);return s&&!s.ghost&&r&&!r.ghost}process(e){const t=e.messageBus;[t.get(o)||[],t.get(c)||[]].forEach(e=>{e.forEach(e=>{const{gameObject1:s,gameObject2:r,mtv1:i}=e;this._validateCollision(s,r)&&this._addReactionForce(s,i,t)})})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(70);t.default=class extends r.default{async load(e){const{gameObjectObserver:t}=e;return new i.default({gameObjectObserver:t})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(50);const n="COLLISION_ENTER",a="COLLISION_STAY",o="rigidBody",c={STATIC:"static",DYNAMIC:"dynamic"},h="transform";t.default=class extends r.default{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._processedPairs={},this._mtvMap={}}_validateCollision(e,t){const s=e.getComponent(o),r=t.getComponent(o);return s&&!s.ghost&&!s.isPermeable&&r&&!r.ghost&&!r.isPermeable&&(s.type!==c.STATIC||r.type!==c.STATIC)}_setMtv(e,t,s,r){this._mtvMap[e]=this._mtvMap[e]||{},this._mtvMap[e][r]?{static:()=>{this._mtvMap[e][r].x=Math.abs(t)>Math.abs(this._mtvMap[e][r].x)?t:this._mtvMap[e][r].x,this._mtvMap[e][r].y=Math.abs(s)>Math.abs(this._mtvMap[e][r].y)?s:this._mtvMap[e][r].y},dynamic:()=>{this._mtvMap[e][r].x+=t,this._mtvMap[e][r].y+=s}}[r]():this._mtvMap[e][r]=new i.Vector2(t,s)}_resolveCollision(e,t,s,r){const i=e.getId(),n=t.getId(),a=e.getComponent(o),h=t.getComponent(o);a.type===c.STATIC?this._setMtv(n,r.x,r.y,a.type):h.type===c.STATIC?this._setMtv(i,s.x,s.y,h.type):(this._setMtv(i,s.x/2,s.y/2,h.type),this._setMtv(n,r.x/2,r.y/2,a.type))}process(e){const t=e.messageBus;this._processedPairs={},this._mtvMap={},[t.get(n)||[],t.get(a)||[]].forEach(e=>{e.forEach(e=>{const{gameObject1:t,gameObject2:s,mtv1:r,mtv2:i}=e,n=t.getId(),a=s.getId();this._processedPairs[a]&&this._processedPairs[a][n]||(this._processedPairs[n]=this._processedPairs[n]||{},this._processedPairs[n][a]=!0,this._validateCollision(t,s)&&this._resolveCollision(t,s,r,i))})}),Object.keys(this._mtvMap).forEach(e=>{const t=this._gameObjectObserver.getById(e).getComponent(h),s=Object.keys(this._mtvMap[e]);if(1===s.length)return t.offsetX+=this._mtvMap[e][s[0]].x,void(t.offsetY+=this._mtvMap[e][s[0]].y);const{static:r,dynamic:i}=this._mtvMap[e];t.offsetX+=r.x+i.x,t.offsetY+=r.y+i.y})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(72);t.default=class extends r.default{async load(e){const{messages:t}=e;return new i.default({messages:t})}}},function(e,t,s){"use strict";s.r(t);var r=s(30);t.default=class extends r.default{constructor(e){super(),this._messages=e.messages}process(e){const t=e.messageBus;this._messages.forEach(e=>{t.delete(e)})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(74);t.default=class extends r.default{async load(){return new i.default}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(75),n=s(76);const a="INPUT_EVENT_QUERY",o="PRESSED",c="RELEASED",h="_";t.default=class extends r.default{constructor(){super(),this._inputListener=new i.default(window),this._keyCodeMapper=new n.default,this._events=[{type:o,getKeys:()=>this._inputListener.getPressedKeys(),onProcessComplete:()=>this._inputListener.clearPressedKeys()},{type:c,getKeys:()=>this._inputListener.getReleasedKeys(),onProcessComplete:()=>this._inputListener.clearReleasedKeys()}]}processorDidMount(){this._inputListener.startListen()}processorWillUnmount(){this._inputListener.stopListen()}process(e){const t=e.messageBus,s=[];this._events.forEach(e=>{e.getKeys().forEach(t=>{s.push(`${this._keyCodeMapper.getChar(t)}${h}${e.type}`)}),e.onProcessComplete()}),t.send({type:a,query:s})}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e){this._window=e,this._pressedKeys=new Set,this._releasedKeys=new Set}startListen(){this._window.onkeydown=(e=>{this._pressedKeys.add(e.keyCode)}),this._window.onkeyup=(e=>{this._pressedKeys.delete(e.keyCode),this._releasedKeys.add(e.keyCode)})}stopListen(){this._window.onkeydown=null}getPressedKeys(){return Array.from(this._pressedKeys)}getReleasedKeys(){return Array.from(this._releasedKeys)}clearPressedKeys(){this._pressedKeys.clear()}clearReleasedKeys(){this._releasedKeys.clear()}}},function(e,t,s){"use strict";s.r(t);var r=s(77);t.default=class{getChar(e){return r.default[e]}}},function(e,t,s){"use strict";s.r(t),t.default={65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z"}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(79);t.default=class extends r.default{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(30);const i="keyboardControl",n="INPUT_EVENT_QUERY",a="RELEASED",o="_";t.default=class extends r.default{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver}process(e){const t=e.messageBus;this._gameObjectObserver.forEach(e=>{const s=e.getComponent(i);(t.get(n)||[]).forEach(e=>{e.query.forEach(e=>{const t=e.split(o),r=t[0],i=t[1];r in s.keyStates&&(s.keyStates[r]=i)})}),Object.keys(s.keyStates).forEach(r=>{const i=s.keyStates[r],n=s.inputEventBindings[`${r}${o}${i}`];if(i&&n){if(!n.messageType)throw new Error(`The message type not specified for input event: ${i}`);t.send({type:n.messageType,...n.attrs,gameObject:e,id:e.getId()})}i===a&&(s.keyStates[r]=null)})})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(81);t.default=class extends r.default{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(30);const i="mouseControl",n="MOUSE_INPUT_EVENT_QUERY";t.default=class extends r.default{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver}process(e){const t=e.messageBus;(t.get(n)||[]).forEach(e=>{e.query.forEach(e=>{this._gameObjectObserver.forEach(s=>{const r=s.getComponent(i).inputEventBindings[e.type];if(r){if(!r.messageType)throw new Error(`The message type not specified for input event: ${e.type}`);t.send({type:r.messageType,...r.attrs,gameObject:s,id:s.getId(),x:e.x,y:e.y,screenX:e.screenX,screenY:e.screenY})}})})})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(83);t.default=class extends r.default{async load(){return new i.default}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(84);const n="MOUSE_INPUT_EVENT_QUERY",a={1:"LEFT",2:"MIDDLE",3:"RIGHT"},o={mousedown:e=>`MOUSE_${a[e.which]}_BUTTON_PRESS`,mouseup:e=>`MOUSE_${a[e.which]}_BUTTON_RELEASE`,mousemove:()=>"MOUSE_MOVE",click:()=>"MOUSE_LEFT_BUTTON_CLICK",contextmenu:()=>"MOUSE_RIGHT_BUTTON_CLICK",dblclick:()=>"MOUSE_DOUBLE_CLICK"};t.default=class extends r.default{constructor(){super(),this._inputListener=new i.default(window)}processorDidMount(){this._inputListener.startListen()}processorWillUnmount(){this._inputListener.stopListen()}process(e){const t=e.messageBus,s=(this._inputListener.getFiredEvents()||[]).map(e=>({type:o[e.type](e),x:e.clientX,y:e.clientY}));this._inputListener.clearFiredEvents(),t.send({type:n,query:s})}}},function(e,t,s){"use strict";s.r(t);const r=["onmousedown","onmouseup","onmousemove","onclick","oncontextmenu","ondblclick"];t.default=class{constructor(e){this._window=e,this._firedEvents=[]}startListen(){r.forEach(e=>{this._window[e]=(e=>{this._firedEvents.push(e)})})}stopListen(){r.forEach(e=>{this._window[e]=null})}getFiredEvents(){return this._firedEvents}clearFiredEvents(){this._firedEvents=[]}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(86);t.default=class extends r.default{async load(e){const{store:t}=e;return new i.default({store:t})}}},function(e,t,s){"use strict";s.r(t);var r=s(30);const i="MOUSE_INPUT_EVENT_QUERY",n="currentCamera",a="camera",o="transform";t.default=class extends r.default{constructor(e){super();const{store:t}=e;this._store=t}process(e){const t=e.messageBus,s=this._store.get(n),{windowSizeX:r,windowSizeY:c,zoom:h}=s.getComponent(a),l=r/2,u=c/2,{offsetX:d,offsetY:_}=s.getComponent(o);(t.get(i)||[]).forEach(e=>{e.query.forEach(e=>{e.screenX=e.x,e.screenY=e.y,e.x=(e.x-l)/h+d,e.y=(e.y-u)/h+_})})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(88);t.default=class extends r.default{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(50);const n="MOVEMENT",a="transform",o="movement";t.default=class extends r.default{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver}process(e){const t=e.deltaTime/1e3,s=(e.messageBus.get(n)||[]).reduce((e,t)=>{const{gameObject:s,directionAngle:r}=t,n=s.getId();return e[n]=e[n]||new i.Vector2(0,0),e[n].add(i.VectorOps.getVectorByAngle(i.MathOps.degToRad(r))),e},{});this._gameObjectObserver.forEach(e=>{const r=e.getId(),{vector:i,speed:n,penalty:c}=e.getComponent(o);i.multiplyNumber(0);const h=s[r];if(!h||0===h.x&&0===h.y)return;const l=e.getComponent(a),u=c<n?n-c:0;h.multiplyNumber(u*t*(1/h.magnitude)),i.add(h),l.offsetX=l.offsetX+i.x,l.offsetY=l.offsetY+i.y})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(90);t.default=class extends r.default{async load(e){const{gravitationalAcceleration:t,gameObjectObserver:s,store:r}=e;return new i.default({gravitationalAcceleration:t,gameObjectObserver:s,store:r})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(50);const n="ADD_FORCE",a="STOP_MOVEMENT",o="rigidBody",c="transform",h="gravityForce",l="gravitationalAcceleration",u={UP:new i.Vector2(0,-1),LEFT:new i.Vector2(-1,0),RIGHT:new i.Vector2(1,0),DOWN:new i.Vector2(0,1)};t.default=class extends r.default{constructor(e){super();const{gravitationalAcceleration:t,gameObjectObserver:s,store:r}=e;this._gravitationalAcceleration=t,this._gameObjectObserver=s,this._store=r,this._gameObjectsVelocity={},this._temproraryForcesMap={}}processorDidMount(){this._store.set(l,this._gravitationalAcceleration)}_filterTemporaryForces(e,t,s){const r=this._temproraryForcesMap[e]||{};Object.keys(t).forEach(e=>{const i=r[e];if(null!==i&&void 0!==i){if(i<=0)return t[e]=null,void(r[e]=null);i<s&&t[e].multiplyNumber(i/s),r[e]-=s}})}_addGravityForce(e,t){const{mass:s,useGravity:r}=e;r&&!t[h]&&(t[h]=new i.Vector2(0,0),t[h].add(u.DOWN),t[h].multiplyNumber(s*this._gravitationalAcceleration))}_applyDragForce(e,t){const{mass:s,drag:r}=e.getComponent(o),i=e.getId(),n=this._gameObjectsVelocity[i];if(!r||!n||!n.x&&!n.y)return;const a=Math.sign(n.x),c=Math.sign(n.y),h=-1*r*(s*this._gravitationalAcceleration)*(t/s),l=1/n.magnitude,u=n.clone();u.multiplyNumber(h*l),n.add(u),Math.sign(n.x)!==a&&Math.sign(n.y)!==c&&n.multiplyNumber(0)}_processIncomingForces(e,t,s){(s.getById(n,e)||[]).forEach(s=>{const{name:r,value:i,duration:n}=s;this._temproraryForcesMap[e]=this._temproraryForcesMap[e]||{},n?this._temproraryForcesMap[e][r]=n:this._temproraryForcesMap[e][r]&&(this._temproraryForcesMap[e][r]=null),t[r]=i})}_processConstraints(e){(e.get(a)||[]).forEach(e=>{const{gameObject:t}=e,s=t.getId();this._gameObjectsVelocity[s]&&this._gameObjectsVelocity[s].multiplyNumber(0)})}_processRemovedGameObjects(){this._gameObjectObserver.getLastRemoved().forEach(e=>{const t=e.getId();this._gameObjectsVelocity[t]=null})}process(e){const t=e.deltaTime,s=t/1e3,r=e.messageBus;this._processRemovedGameObjects(),this._processConstraints(r),this._gameObjectObserver.forEach(e=>{const n=e.getId(),a=e.getComponent(o),h=e.getComponent(c),{mass:l}=a,u={};this._addGravityForce(a,u),this._processIncomingForces(n,u,r),this._filterTemporaryForces(n,u,t);const d=Object.keys(u).reduce((e,t)=>u[t]?(e.add(u[t]),e):e,new i.Vector2(0,0));this._gameObjectsVelocity[n]=this._gameObjectsVelocity[n]||new i.Vector2(0,0);const _=this._gameObjectsVelocity[n];if(d.x||d.y){const e=d.clone();e.multiplyNumber(s/l),_.add(e)}this._applyDragForce(e,s),h.offsetX=h.offsetX+_.x*s,h.offsetY=h.offsetY+_.y*s})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(5),n=s(10),a=s(92);t.default=class extends r.default{async load(e){const t=i.default.resolve(n.RESOURCES_LOADER_KEY_NAME),{windowNodeId:s,textureAtlas:r,textureAtlasDescriptor:o,backgroundColor:c,sortingLayers:h,scaleSensitivity:l,gameObjectObserver:u,store:d}=e,_=document.getElementById(s),g=[r,o],f=await Promise.all(g.map(e=>t.load(e)));return new a.default({window:_,textureAtlas:f[0],textureAtlasDescriptor:f[1],backgroundColor:c,sortingLayers:h,scaleSensitivity:l,gameObjectObserver:u,store:d})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(93),n=s(94),a=s(99),o=s(103),c=s(106);const h=255,l=0,u=6,d=1080,_=2,g=Float32Array.BYTES_PER_ELEMENT*_,f=3,m=3*f,p=Float32Array.BYTES_PER_ELEMENT*m,b=Float32Array.BYTES_PER_ELEMENT*f,v=5*_+m,O=v*u,y=1e3*O*Float32Array.BYTES_PER_ELEMENT,w="renderable",E="transform",x="camera",S="currentCamera";t.default=class extends r.default{constructor(e){super();const{window:t,textureAtlas:s,textureAtlasDescriptor:r,backgroundColor:i,gameObjectObserver:o,sortingLayers:h,store:l,scaleSensitivity:u}=e;this.textureAtlas=s,this.textureAtlasSize={width:this.textureAtlas.width,height:this.textureAtlas.height},this.textureAtlasDescriptor=r,this.textureHandlers=Object.keys(a.default).reduce((e,t)=>{const s=a.default[t];return e[t]=new s,e},{}),this._matrixTransformer=new c.default,this._backgroundColor=new n.default(i),this._view=t,this._viewWidth,this._viewHeight,this._windowDidResize=!0,this._onWindowResize=this._onWindowResize.bind(this),this._shaders=[],this._sortingLayer=h.reduce((e,t,s)=>(e[t]=s,e),{}),this._store=l,this._gameObjectObserver=o,this._scaleSensitivity=Math.min(Math.max(u,0),100)/100,this._screenScale=1,this._vaoExt=null,this._buffer=null,this._vao=null,this._geometry={},this._viewMatrixStats={},this._vertexData=null,this._gameObjectsCount=0}processorDidMount(){window.addEventListener("resize",this._onWindowResize),this.gl=this._initGraphicContext(),this._initExtensions(),this._initScreen(),this.program=this._initShaders(),this._initProgramInfo(),this.textures=this._initTextures()}processorWillUnmount(){window.removeEventListener("resize",this._onWindowResize),this._shaders.forEach(e=>{this.gl.detachShader(this.program,e),this.gl.deleteShader(e)}),this.gl.deleteProgram(this.program),this.gl.deleteTexture(this.textures),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this._buffer=null,this._shaders=[],this.program=null,this.textures=null,this.gl=null,this._vao=null,this._vaoExt=null,this._geometry={},this._viewMatrixStats={},this._vertexData=null,this._gameObjectsCount=0}_onWindowResize(){this._windowDidResize=!0}_initGraphicContext(){let e=null;try{e=this._view.getContext("webgl")||this._view.getContext("experimental-webgl")}catch(e){throw new Error("Unable to get graphic context.")}if(!e)throw new Error("Unable to initialize WebGL. Your browser may not support it.");return e}_initExtensions(){if(this._vaoExt=this.gl.getExtension("OES_vertex_array_object"),!this._vaoExt)return alert("Unable to initialize OES_vertex_array_object extension")}_initScreen(){this.gl.clearColor(this._backgroundColor.red()/h,this._backgroundColor.green()/h,this._backgroundColor.blue()/h,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.depthFunc(this.gl.LEQUAL),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}_initShaders(){const e=new o.default(this.gl),t=e.create(e.VERTEX_SHADER),s=e.create(e.FRAGMENT_SHADER),r=this.gl.createProgram();if(this.gl.attachShader(r,t),this.gl.attachShader(r,s),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error("Unable to initialize the shader program.");return this._shaders.push(t,s),r}_initProgramInfo(){this.gl.useProgram(this.program),this._variables={aPosition:this.gl.getAttribLocation(this.program,"a_position"),aTexCoord:this.gl.getAttribLocation(this.program,"a_texCoord"),aModelViewMatrix:this.gl.getAttribLocation(this.program,"a_modelViewMatrix"),aTexSize:this.gl.getAttribLocation(this.program,"a_texSize"),aTexTranslate:this.gl.getAttribLocation(this.program,"a_texTranslate"),aGameObjectSize:this.gl.getAttribLocation(this.program,"a_gameObjectSize"),uViewMatrix:this.gl.getUniformLocation(this.program,"u_viewMatrix"),uTexAtlasSize:this.gl.getUniformLocation(this.program,"u_texAtlasSize")},this._buffer=this.gl.createBuffer(),this._vao=this._createVAO(),this._setUpGlobalUniforms()}_createVAO(){const e=this._vaoExt.createVertexArrayOES();this._vaoExt.bindVertexArrayOES(e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,y,this.gl.DYNAMIC_DRAW);const t=[{loc:this._variables.aPosition,type:"vec2"},{loc:this._variables.aTexCoord,type:"vec2"},{loc:this._variables.aModelViewMatrix,type:"mat3"},{loc:this._variables.aTexSize,type:"vec2"},{loc:this._variables.aTexTranslate,type:"vec2"},{loc:this._variables.aGameObjectSize,type:"vec2"}],s={mat3:p,vec2:g},r=t.reduce((e,t)=>e+s[t.type],0);let i=0;for(let e=0;e<t.length;e++)if("vec2"===t[e].type)this.gl.enableVertexAttribArray(t[e].loc),this.gl.vertexAttribPointer(t[e].loc,_,this.gl.FLOAT,!1,r,i),i+=g;else if("mat3"===t[e].type){for(let s=0;s<f;s++){const n=t[e].loc+s;this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,f,this.gl.FLOAT,!1,r,i+s*b)}i+=p}return this._vaoExt.bindVertexArrayOES(null),e}_setUpGlobalUniforms(){this.gl.uniform2fv(this._variables.uTexAtlasSize,[this.textureAtlasSize.width,this.textureAtlasSize.height])}_initTextures(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.textureAtlas),e}_getModelViewMatrix(e,t,s,r){const i=this._matrixTransformer,n=i.getIdentityMatrix();return i.translate(n,e.origin[0],e.origin[1]),e.flipX&&i.flipX(n),e.flipY&&i.flipY(n),i.rotate(n,(e.rotation+r)%360),i.translate(n,t,s),n}_getCompareFunction(){return(e,t)=>{const s=e.getComponent(w),r=t.getComponent(w),i=this._sortingLayer[s.sortingLayer],n=this._sortingLayer[r.sortingLayer];if(i>n)return 1;if(i<n)return-1;const a=e.getComponent(E),o=t.getComponent(E),c=a.offsetY+s.height/2,h=o.offsetY+r.height/2;if(c>h)return 1;if(c<h)return-1;const l=a.offsetX+s.width/2,u=o.offsetX+r.width/2;return l>u?1:l<u?-1:0}}_setUpTextureInfo(e,t,s){this._vertexData[s]=e.width,this._vertexData[s+1]=e.height,this._vertexData[s+2]=e.x,this._vertexData[s+3]=e.y,this._vertexData[s+4]=t.width,this._vertexData[s+5]=t.height}_setUpMatrix(e,t){this._vertexData[t]=e[0],this._vertexData[t+1]=e[1],this._vertexData[t+2]=e[2],this._vertexData[t+3]=e[3],this._vertexData[t+4]=e[4],this._vertexData[t+5]=e[5],this._vertexData[t+6]=e[6],this._vertexData[t+7]=e[7],this._vertexData[t+8]=e[8]}_setUpVertexData(e,t){const s=e.getId(),r=e.getComponent(w),n=t*O;if(r.disabled){for(let e=0;e<O;e++)this._vertexData[n+e]=0;return}const a=e.getComponent(E),o=this.textureAtlasDescriptor[r.src],c=this.textureHandlers[r.type].handle(o,r),h=this._getModelViewMatrix(r,a.offsetX,a.offsetY,a.rotation);this._geometry[s]||(this._geometry[s]={position:new i.default(r.width,r.height).toArray(),texCoord:new i.default(c.width,c.height).toArray()});const l=this._geometry[s].position,u=this._geometry[s].texCoord;for(let e=0,t=n;e<l.length;e+=2,t+=v)this._vertexData[t]=l[e],this._vertexData[t+1]=l[e+1],this._vertexData[t+2]=u[e],this._vertexData[t+3]=u[e+1],this._setUpMatrix(h,t+2*_),this._setUpTextureInfo(c,r,t+2*_+m)}_resizeCanvas(e){if(!this._windowDidResize)return;const t=window.devicePixelRatio||1;this._viewWidth=this._view.clientWidth,this._viewHeight=this._view.clientHeight;const s=this._viewWidth*t,r=this._viewHeight*t;e.width=s,e.height=r;const i=Math.sqrt(Math.pow(e.clientWidth,2)+Math.pow(e.clientHeight,2)),n=1-this._scaleSensitivity,a=i-(i-d)*n;this._screenScale=a/d,this.gl.viewport(0,0,s,r),this._windowDidResize=!1}_updateViewMatrix(){const e=this._store.get(S),t=e.getComponent(E),{zoom:s}=e.getComponent(x),r=s*this._screenScale,i=this._viewMatrixStats;if(i.x===t.offsetX&&i.y===t.offsetY&&i.width===this._viewWidth&&i.height===this._viewHeight&&i.scale===r)return;const n=this._matrixTransformer,a=n.getIdentityMatrix();n.translate(a,-t.offsetX,-t.offsetY),n.scale(a,r,r),n.project(a,this._viewWidth,this._viewHeight),this.gl.uniformMatrix3fv(this._variables.uViewMatrix,!1,a),this._viewMatrixStats.width=this._viewWidth,this._viewMatrixStats.height=this._viewHeight,this._viewMatrixStats.x=t.offsetX,this._viewMatrixStats.y=t.offsetY,this._viewMatrixStats.scale=r}_allocateVertexData(){const e=this._gameObjectObserver.size();this._gameObjectsCount!==e&&(this._gameObjectsCount=e,this._vertexData=new Float32Array(this._gameObjectsCount*O))}_setUpBuffers(){this._vaoExt.bindVertexArrayOES(this._vao),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this._vertexData)}_processRemovedGameObjects(){this._gameObjectObserver.getLastRemoved().forEach(e=>{const t=e.getId();this._geometry[t]=null})}process(){const e=this.gl.canvas;this._resizeCanvas(e),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this._processRemovedGameObjects(),this._updateViewMatrix(),this._allocateVertexData(),this._gameObjectObserver.sort(this._getCompareFunction()),this._gameObjectObserver.forEach((e,t)=>{this._setUpVertexData(e,t)}),this._setUpBuffers(),this.gl.drawArrays(this.gl.TRIANGLES,l,u*this._gameObjectObserver.size())}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e,t){this._width=e,this._height=t}toArray(){const e=0+this._width,t=0+this._height;return[0,0,e,0,0,t,0,t,e,0,e,t]}}},function(e,t,s){"use strict";s.r(t);var r=s(95);const i=/#[0-9a-zA-Z]{6}/,n=/#[0-9a-zA-Z]{3}/,a="red",o="green",c="blue";t.default=class{constructor(e){const t=[{regexp:i,reader:r.default.hexColorReader},{regexp:n,reader:r.default.shortHeColorReader}];if(this._color=void 0,t.some(t=>{if(e.match(t.regexp)){const s=t.reader;return this._color=(new s).read(e),!0}}),!this._color)throw new Error("Error while color initialization: unknown type of color presentation")}red(){return this._color[a]}green(){return this._color[o]}blue(){return this._color[c]}}},function(e,t,s){"use strict";s.r(t);var r=s(96),i=s(98);t.default={hexColorReader:r.default,shortHeColorReader:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(97);const i=8,n=16,a=255,o="#",c=["red","green","blue"];t.default=class extends r.default{read(e){const t=parseInt(e.replace(o,""),n);return c.reduce((e,s,r,n)=>(e[s]=t>>i*(n.length-r-1)&a,e),{})}}},function(e,t,s){"use strict";s.r(t);t.default=class{read(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(97);const i=16,n=2,a="#",o=["red","green","blue"];t.default=class extends r.default{read(e){return e=e.replace(a,""),o.reduce((t,s,r)=>(t[s]=parseInt(e[r].repeat(n),i),t),{})}}},function(e,t,s){"use strict";s.r(t);var r=s(100),i=s(102);t.default={static:r.default,sprite:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(101);t.default=class extends r.default{handle(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}}},function(e,t,s){"use strict";s.r(t);t.default=class{handle(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(101);t.default=class extends r.default{handle(e,t){const{x:s,y:r,width:i,height:n}=e,{spacing:a,extruding:o,slice:c}=t,h=2*o,l=(i-(c-1)*a)/c-h,u=n-h;return{x:s+(l+a+h)*t.currentFrame+o,y:r+o,width:l,height:u}}}},function(e,t,s){"use strict";s.r(t);var r=s(104),i=s(105);const n="FRAGMENT_SHADER",a="VERTEX_SHADER",o={[n]:r.default,[a]:i.default};t.default=class{constructor(e){this.graphicContext=e,this.FRAGMENT_SHADER=n,this.VERTEX_SHADER=a,this.creators={[n]:this._createFragmentShader.bind(this),[a]:this._createVertexShader.bind(this)}}_createFragmentShader(){return this.graphicContext.createShader(this.graphicContext.FRAGMENT_SHADER)}_createVertexShader(){return this.graphicContext.createShader(this.graphicContext.VERTEX_SHADER)}create(e){const t=this.creators[e]();if(this.graphicContext.shaderSource(t,o[e]),this.graphicContext.compileShader(t),!this.graphicContext.getShaderParameter(t,this.graphicContext.COMPILE_STATUS)){const e=this.graphicContext.getShaderInfoLog(t);throw new Error(`An error occurred compiling the shaders: ${e}`)}return t}}},function(e,t,s){"use strict";s.r(t);t.default="\nprecision highp float;\n\nuniform sampler2D u_image;\nuniform vec2 u_texAtlasSize;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_texSize;\nvarying vec2 v_texTranslate;\nvarying vec2 v_gameObjectSize;\n\nfloat calculateCoord(float gameObjectSize, float texSize, float texTranslate, float texCoord) {\n  if (gameObjectSize > texSize) {\n    float repeat = gameObjectSize / texSize;\n    return mod(texCoord * repeat, texSize) + texTranslate;\n  } else {\n    return texCoord + texTranslate;\n  }\n}\n\nvoid main() {\n  vec2 texCoord = vec2(\n    calculateCoord(v_gameObjectSize.x, v_texSize.x, v_texTranslate.x, v_texCoord.x),\n    calculateCoord(v_gameObjectSize.y, v_texSize.y, v_texTranslate.y, v_texCoord.y)\n  );\n\n  gl_FragColor = texture2D(u_image, texCoord / u_texAtlasSize);\n}\n"},function(e,t,s){"use strict";s.r(t);t.default="\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nattribute mat3 a_modelViewMatrix;\n\nattribute vec2 a_texSize;\nattribute vec2 a_texTranslate;\nattribute vec2 a_gameObjectSize;\n\nuniform mat3 u_viewMatrix;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_texSize;\nvarying vec2 v_texTranslate;\nvarying vec2 v_gameObjectSize;\n\nvoid main() {\n  mat3 matrix = u_viewMatrix * a_modelViewMatrix;\n  gl_Position = vec4((matrix * vec3(a_position, 1)).xy, 0, 1);\n\n  v_texCoord = a_texCoord;\n  v_texSize = a_texSize;\n  v_texTranslate = a_texTranslate;\n  v_gameObjectSize = a_gameObjectSize;\n}\n"},function(e,t,s){"use strict";s.r(t);t.default=class{getIdentityMatrix(){return[1,0,0,0,1,0,0,0,1]}project(e,t,s){const r=2/t,i=2/s;e[0]=e[0]*r,e[1]=-e[1]*i,e[3]=e[3]*r,e[4]=-e[4]*i,e[6]=e[6]*r,e[7]=-e[7]*i}translate(e,t,s){e[0]=e[0]+e[2]*t,e[1]=e[1]+e[2]*s,e[3]=e[3]+e[5]*t,e[4]=e[4]+e[5]*s,e[6]=e[6]+e[8]*t,e[7]=e[7]+e[8]*s}flipX(e){this.scale(e,-1,1)}flipY(e){this.scale(e,1,-1)}scale(e,t,s){e[0]=e[0]*t,e[1]=e[1]*s,e[3]=e[3]*t,e[4]=e[4]*s,e[6]=e[6]*t,e[7]=e[7]*s}rotate(e,t){t=t*Math.PI/180;const s=Math.cos(t),r=-Math.sin(t),i=e[0],n=e[3],a=e[6];e[0]=i*s+e[1]*r,e[1]=e[1]*s-i*r,e[3]=n*s+e[4]*r,e[4]=e[4]*s-n*r,e[6]=a*s+e[7]*r,e[7]=e[7]*s-a*r}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(108);t.default=class extends r.default{async load(e){const{sceneController:t}=e;return new i.default({sceneController:t})}}},function(e,t,s){"use strict";s.r(t);var r=s(30);const i="LOAD_SCENE";t.default=class extends r.default{constructor(e){super(),this._sceneController=e.sceneController,this._sceneLoading=!1}_loadScene(e){const t=e.get(i);if(t){const{name:e}=t[t.length-1];this._sceneController.load(e),this._sceneLoading=!0}}_moveToLoaded(e){e.reset(),this._sceneController.moveToLoaded(),this._sceneLoading=!1}process(e){const t=e.messageBus;this._sceneLoading?this._sceneController.isLoaded()&&this._moveToLoaded(t):this._loadScene(t)}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(110);t.default=class extends r.default{async load(e){const{helpers:t,gameObjectObserver:s,gameObjectSpawner:r,gameObjectDestroyer:n,store:a}=e,{scripts:o}=await t.loadScripts();return new i.default({gameObjectObserver:s,gameObjectSpawner:r,gameObjectDestroyer:n,store:a,scripts:o})}}},function(e,t,s){"use strict";s.r(t);var r=s(30);const i="script";t.default=class extends r.default{constructor(e){super();const{gameObjectObserver:t,gameObjectSpawner:s,gameObjectDestroyer:r,store:i,scripts:n}=e;this._gameObjectObserver=t,this._gameObjectSpawner=s,this._gameObjectDestroyer=r,this._store=i,this._scripts=n,this._activeScripts={}}_processRemovedGameObjects(){this._gameObjectObserver.getLastRemoved().forEach(e=>{const t=e.getId();this._activeScripts[t]=null})}process(e){const{messageBus:t,deltaTime:s}=e;this._processRemovedGameObjects(),this._gameObjectObserver.forEach(e=>{const r=e.getId(),{name:n}=e.getComponent(i),a=this._scripts[n];this._activeScripts[r]=this._activeScripts[r]||new a(e,this._store,this._gameObjectSpawner,this._gameObjectDestroyer),this._activeScripts[r].update(t,s)})}}},function(e,t,s){"use strict";s.r(t);var r=s(31),i=s(112);t.default=class extends r.default{async load(e){const{helpers:t,sceneController:s,gameObjectObserver:r,gameObjectSpawner:n,gameObjectDestroyer:a,store:o}=e,{onInit:c,onDestroy:h}=await t.loadUiApp();return new i.default({onInit:c,onDestroy:h,sceneController:s,gameObjectObserver:r,gameObjectSpawner:n,gameObjectDestroyer:a,store:o})}}},function(e,t,s){"use strict";s.r(t);var r=s(30),i=s(113),n=s(114);t.default=class extends r.default{constructor(e){super();const{onInit:t,onDestroy:s,sceneController:r,gameObjectObserver:a,gameObjectSpawner:o,gameObjectDestroyer:c,store:h}=e;this._onUiInit=t,this._onUiDestroy=s,this._sceneController=r,this._gameObjectObserver=a,this._gameObjectSpawner=o,this._gameObjectDestroyer=c,this._store=h,this._messageBusObserver=new i.default,this._storeObserver=new i.default,this._gameObjects=new n.default,this._messageQueue=[],this._actionsQueue=[]}processorDidMount(){this._onUiInit({sceneName:this._sceneController.getCurrentName(),messageBusObserver:this._messageBusObserver,storeObserver:this._storeObserver,pushMessage:this._pushMessage.bind(this),pushAction:this._pushAction.bind(this),gameObjects:this._gameObjects})}processorWillUnmount(){this._onUiDestroy()}_pushAction(e){this._actionsQueue.push(e)}_pushMessage(e){this._messageQueue.push(e)}_processRemovedGameObjects(){this._gameObjectObserver.getLastRemoved().forEach(e=>{this._gameObjects.next(null,e.getId())})}process(e){const{messageBus:t,deltaTime:s}=e;this._processRemovedGameObjects(),this._gameObjectObserver.forEach(e=>{this._gameObjects.next(e,e.getId())}),this._messageBusObserver.next(t),this._storeObserver.next(this._store),this._messageQueue.forEach(e=>{t.send(e,!0)}),this._messageQueue=[],this._actionsQueue.forEach(e=>{e({messageBus:t,deltaTime:s,store:this._store,gameObjectSpawner:this._gameObjectSpawner,gameObjectDestroyer:this._gameObjectDestroyer})}),this._actionsQueue=[]}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(){this._value=null,this._subscribers=[]}next(e){this._value=e,this._subscribers.forEach(e=>e(this._value))}subscribe(e){if(!(e instanceof Function))throw new Error("Callback should be a function");this._subscribers.push(e)}unsubscribe(e){if(!(e instanceof Function))throw new Error("Callback should be a function");this._subscribers=this._subscribers.filter(t=>t!==e)}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(){this._values={},this._subscribers={}}next(e,t){this._values[t]=e,this._subscribers[t]&&this._subscribers[t].forEach(e=>e(this._values[t]))}subscribe(e,t){if(!(e instanceof Function))throw new Error("Callback should be a function");this._subscribers[t]=this._subscribers[t]||[],this._subscribers[t].push(e)}unsubscribe(e,t){if(!(e instanceof Function))throw new Error("Callback should be a function");this._subscribers[t]&&(this._subscribers[t]=this._subscribers[t].filter(t=>t!==e))}}},function(e,t,s){"use strict";s.r(t);var r=s(116),i=s(117),n=s(118),a=s(121),o=s(122),c=s(133),h=s(134),l=s(135),u=s(136),d=s(137);t.default={camera:r.default,keyboardControl:i.default,colliderContainer:n.default,rigidBody:a.default,animatable:o.default,renderable:c.default,transform:h.default,movement:l.default,mouseControl:u.default,script:d.default}},function(e,t,s){"use strict";s.r(t);var r=s(32);class i extends r.default{constructor(e){super(),this._zoom=e.zoom,this._windowSizeX=0,this._windowSizeY=0}set zoom(e){this._zoom=e}get zoom(){return this._zoom}set windowSizeX(e){this._windowSizeX=e}get windowSizeX(){return this._windowSizeX}set windowSizeY(e){this._windowSizeY=e}get windowSizeY(){return this._windowSizeY}clone(){return new i({zoom:this.zoom})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(32);const i="_";class n extends r.default{constructor(e){super(),this._inputEventBindings=e.inputEventBindings,this._keyStates=Object.keys(this._inputEventBindings).reduce((e,t)=>(e[t.split(i)[0]]=null,e),{})}set inputEventBindings(e){this._inputEventBindings=e}get inputEventBindings(){return this._inputEventBindings}set keyStates(e){this._keyStates=e}get keyStates(){return this._keyStates}clone(){return new n({inputEventBindings:{...this.inputEventBindings}})}}t.default=n},function(e,t,s){"use strict";s.r(t);var r=s(32),i=s(119),n=s(120);class a extends r.default{constructor(e){if(super(),this._colliders={boxCollider:i.default,circleCollider:n.default},this._type=e.type,!this._colliders[this.type])throw new Error(`Not found collider with same type: ${this.type}`);this._collider=new this._colliders[this.type](e.collider)}set type(e){this._type=e}get type(){return this._type}set collider(e){this._collider=e}get collider(){return this._collider}clone(){return new a({type:this.type,collider:this.collider.clone()})}}t.default=a},function(e,t,s){"use strict";s.r(t);class r{constructor(e){this._sizeX=e.sizeX,this._sizeY=e.sizeY,this._centerX=e.centerX,this._centerY=e.centerY}set sizeX(e){this._sizeX=e}get sizeX(){return this._sizeX}set sizeY(e){this._sizeY=e}get sizeY(){return this._sizeY}set centerX(e){this._centerX=e}get centerX(){return this._centerX}set centerY(e){this._centerY=e}get centerY(){return this._centerY}clone(){return new r({sizeX:this.sizeX,sizeY:this.sizeY,centerX:this.centerX,centerY:this.centerY})}}t.default=r},function(e,t,s){"use strict";s.r(t);class r{constructor(e){this._radius=e.radius,this._centerX=e.centerX,this._centerY=e.centerY}set radius(e){this._radius=e}get radius(){return this._radius}set centerX(e){this._centerX=e}get centerX(){return this._centerX}set centerY(e){this._centerY=e}get centerY(){return this._centerY}clone(){return new r({radius:this.radius,centerX:this.centerX,centerY:this.centerY})}}t.default=r},function(e,t,s){"use strict";s.r(t);var r=s(32);class i extends r.default{constructor(e){super(),this._type=e.type,this._mass=e.mass,this._useGravity=e.useGravity,this._isPermeable=e.isPermeable,this._ghost=e.ghost,this._drag=e.drag}set mass(e){this._mass=e}get mass(){return this._mass}set useGravity(e){this._useGravity=e}get useGravity(){return this._useGravity}set isPermeable(e){this._isPermeable=e}get isPermeable(){return this._isPermeable}set ghost(e){this._ghost=e}get ghost(){return this._ghost}set type(e){this._type=e}get type(){return this._type}set drag(e){this._drag=e}get drag(){return this._drag}clone(){return new i({mass:this.mass,useGravity:this.useGravity,isPermeable:this.isPermeable,ghost:this.ghost,type:this.type,drag:this.drag})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(32),i=s(123);class n extends r.default{constructor(e){super(),this._states=e.states.map(e=>new i.default(e)),this._defaultState=e.defaultState,this.currentState=this._defaultState,this.duration=0}set states(e){this._states=e}get states(){return this._states}set defaultState(e){this._defaultState=e}get defaultState(){return this._defaultState}set currentState(e){this._currentState=this.states.find(t=>t.name===e)}get currentState(){return this._currentState}set duration(e){this._duration=e}get duration(){return this._duration}clone(){return new n({states:this.states.map(e=>e.clone()),defaultState:this.defaultState})}}t.default=n},function(e,t,s){"use strict";s.r(t);var r=s(124),i=s(125);class n{constructor(e){this._name=e.name,this._speed=e.speed,this._frames=e.frames.map(e=>new r.default(e)),this._looped=e.looped,this._fallbackState=e.fallbackState,this._transitions=e.transitions.map(e=>new i.default(e)),this._previousState=null}set name(e){this._name=e}get name(){return this._name}set speed(e){this._speed=e}get speed(){return this._speed}set frames(e){this._frames=e}get frames(){return this._frames}set looped(e){this._looped=e}get looped(){return this._looped}set fallbackState(e){this._fallbackState=e}get fallbackState(){return this._fallbackState}set transitions(e){this._transitions=e}get transitions(){return this._transitions}set previousState(e){this._previousState=e}get previousState(){return this._previousState}clone(){return new n({name:this.name,speed:this.speed,frames:this.frames.map(e=>e.clone()),looped:this.looped,fallbackState:this.fallbackState,transitions:this.transitions.map(e=>e.clone())})}}t.default=n},function(e,t,s){"use strict";s.r(t);class r{constructor(e){this._index=e.index,this._rotation=e.rotation,this._flipX=e.flipX,this._flipY=e.flipY,this._disabled=e.disabled}set index(e){this._index=e}get index(){return this._index}set rotation(e){this._rotation=e}get rotation(){return this._rotation}set flipX(e){this._flipX=e}get flipX(){return this._flipX}set flipY(e){this._flipY=e}get flipY(){return this._flipY}set disabled(e){this._disabled=e}get disabled(){return this._disabled}clone(){return new r({index:this.index,rotation:this.rotation,flipX:this.flipX,flipY:this.flipY,disabled:this.disabled})}}t.default=r},function(e,t,s){"use strict";s.r(t);var r=s(126);class i{constructor(e){this._state=e.state,this._conditions=e.conditions.map(e=>new r.default(e))}set state(e){this._state=e}get state(){return this._state}set conditions(e){this._conditions=e}get conditions(){return this._conditions}clone(){return new i({state:this.state,conditions:this.conditions.map(e=>e.clone())})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(127);class i{constructor(e){this._type=e.type,this._props=new r.default[e.type](e.props)}set type(e){this._type=e}get type(){return this._type}set props(e){this._props=e}get props(){return this._props}clone(){return new i({type:this.type,props:this.props.clone()})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(128),i=s(132);t.default={comparator:r.default,message:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(129);class i{constructor(e){this._operation=e.operation,this._arg1=new r.default[e.arg1.type](e.arg1),this._arg2=new r.default[e.arg2.type](e.arg2)}set operation(e){this._operation=e}get operation(){return this._operation}set arg1(e){this._arg1=e}get arg1(){return this._arg1}set arg2(e){this._arg2=e}get arg2(){return this._arg2}clone(){return new i({operation:this.operation,arg1:this.arg1.clone(),arg2:this.arg2.clone()})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(130),i=s(131);t.default={number:r.default,componentValue:i.default}},function(e,t,s){"use strict";s.r(t);class r{constructor(e){this._type=e.type,this._value=e.value}set type(e){this._type=e}get type(){return this._type}set value(e){this._value=e}get value(){return this._value}clone(){return new r({type:this.type,value:this.value})}}t.default=r},function(e,t,s){"use strict";s.r(t);const r=".";class i{constructor(e){this._type=e.type,this._value=Array.isArray(e.value)?e.value:e.value.split(r)}set type(e){this._type=e}get type(){return this._type}set value(e){this._value=e}get value(){return this._value}clone(){return new i({type:this.type,value:this.value.slice(0)})}}t.default=i},function(e,t,s){"use strict";s.r(t);class r{constructor(e){this._message=e.message}set message(e){this._message=e}get message(){return this._message}clone(){return new r({message:this.message})}}t.default=r},function(e,t,s){"use strict";s.r(t);var r=s(32);class i extends r.default{constructor(e){super(),this._src=e.src,this._width=e.width,this._height=e.height,this._type=e.type,this._slice=e.slice,this._spacing=e.spacing||0,this._extruding=e.extruding||0,this._currentFrame="sprite"===e.type?0:void 0,this._rotation=e.rotation,this._origin=e.origin,this._flipX=e.flipX,this._flipY=e.flipY,this._disabled=e.disabled,this._sortingLayer=e.sortingLayer}set src(e){this._src=e}get src(){return this._src}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set type(e){this._type=e}get type(){return this._type}set slice(e){this._slice=e}get slice(){return this._slice}set spacing(e){this._spacing=e}get spacing(){return this._spacing}set extruding(e){this._extruding=e}get extruding(){return this._extruding}set currentFrame(e){this._currentFrame=e}get currentFrame(){return this._currentFrame}set rotation(e){this._rotation=e}get rotation(){return this._rotation}set origin(e){this._origin=e}get origin(){return[this._origin[0]-this.width/2,this._origin[1]-this.height/2]}set flipX(e){this._flipX=e}get flipX(){return this._flipX}set flipY(e){this._flipY=e}get flipY(){return this._flipY}set disabled(e){this._disabled=e}get disabled(){return this._disabled}set sortingLayer(e){this._sortingLayer=e}get sortingLayer(){return this._sortingLayer}clone(){return new i({src:this.src,width:this.width,height:this.height,type:this.type,slice:this.slice,spacing:this.spacing,extruding:this.extruding,rotation:this.rotation,origin:this._origin,flipX:this.flipX,flipY:this.flipY,disabled:this.disabled,sortingLayer:this.sortingLayer})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(32);class i extends r.default{constructor(e){super(),this._offsetX=e.offsetX,this._offsetY=e.offsetY,this._rotation=e.rotation}set offsetX(e){this._offsetX=e-(this._parent?this._parent.offsetX:0)}get offsetX(){return this._offsetX+(this._parent?this._parent.offsetX:0)}set offsetY(e){this._offsetY=e-(this._parent?this._parent.offsetY:0)}get offsetY(){return this._offsetY+(this._parent?this._parent.offsetY:0)}set rotation(e){this._rotation=e-(this._parent?this._parent.rotation:0)}get rotation(){return this._rotation+(this._parent?this._parent.rotation:0)}clone(){return new i({offsetX:this.offsetX,offsetY:this.offsetY,rotation:this.rotation})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(32),i=s(50);class n extends r.default{constructor(e){super(),this._speed=e.speed,this._vector=new i.Vector2(0,0),this._penalty=0}set speed(e){this._speed=e}get speed(){return this._speed}set vector(e){this._vector=e}get vector(){return this._vector}set penalty(e){this._penalty=e}get penalty(){return this._penalty}clone(){return new n({speed:this.speed})}}t.default=n},function(e,t,s){"use strict";s.r(t);var r=s(32);class i extends r.default{constructor(e){super(),this._inputEventBindings=e.inputEventBindings}set inputEventBindings(e){this._inputEventBindings=e}get inputEventBindings(){return this._inputEventBindings}clone(){return new i({inputEventBindings:{...this.inputEventBindings}})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(32);class i extends r.default{constructor(e){super(),this._name=e.name}set name(e){this._name=e}get name(){return this._name}clone(){return new i({name:this.name})}}t.default=i},function(e){e.exports=JSON.parse('{"projectSettings":{},"scenes":{"game":"resources/configurations/scenes/game.json","mainMenu":"resources/configurations/scenes/mainMenu.json"},"prefabs":[{"src":"resources/configurations/prefabs/units/player.json"},{"src":"resources/configurations/prefabs/terrain/island.json"},{"src":"resources/configurations/prefabs/terrain/sea.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerTop.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerBottom.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerLeft.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerRight.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerTopLeft.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerTopRight.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerBottomRight.json"},{"src":"resources/configurations/prefabs/terrain/pathBlockerBottomLeft.json"},{"src":"resources/configurations/prefabs/effects/hit.json"},{"src":"resources/configurations/prefabs/units/enemy.json"},{"src":"resources/configurations/prefabs/units/rangeEnemy.json"},{"src":"resources/configurations/prefabs/items/healGrass.json"},{"src":"resources/configurations/prefabs/items/ogreGrass.json"},{"src":"resources/configurations/prefabs/items/boomGrass.json"},{"src":"resources/configurations/prefabs/items/energyBall.json"}],"startScene":"mainMenu"}')},function(e,t,s){"use strict";s.r(t);var r=s(140),i=s(142),n=s(157),a=s(159),o=s(161),c=s(163),h=s(165),l=s(171),u=s(173),d=s(189),_=s(192),g=s(194),f=s(196),m=s(198),p=s(200);t.default={damageProcessor:r.default,effectsProcessor:i.default,gameOverProcessor:n.default,reaper:a.default,fightProcessor:o.default,enemySpawner:c.default,aiProcessor:h.default,enemiesDetector:l.default,customRenderer:u.default,dayNightSimulator:d.default,grassSpawner:_.default,collectProcessor:g.default,craftProcessor:f.default,itemsActivator:m.default,shootingProcessor:p.default}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(141);t.default=class extends r.ProcessorPlugin{async load(){return new i.default}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="DAMAGE",n="KILL",a="health";t.default=class extends r.Processor{process(e){const t=e.messageBus;(t.get(i)||[]).forEach(e=>{const{gameObject:s,value:r}=e,i=s.getComponent(a);i&&(i.points-=Math.round(r),i.points<=0&&(i.points=0,t.send({type:n,id:s.getId(),gameObject:s})))})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(143);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(144),n=s(151);const a="ADD_EFFECT",o="REMOVE_EFFECT";t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._activeEffectsMap={},this._activeEffects=[]}_removeEffect(e,t){this._activeEffectsMap[t]&&this._activeEffectsMap[t][e]&&(this._activeEffectsMap[t][e].cancel(),this._activeEffectsMap[t][e]=null,this._activeEffects=this._activeEffects.filter(s=>s.name!==e||s.gameObjectId!==t))}_processNewEffects(e){(e.get(a)||[]).forEach(t=>{const{name:s,effectType:r,effect:a,applicatorOptions:o,effectOptions:c,gameObject:h}=t,l=h.getId(),u=new n.default[a](h,e,c),d=new i.default[r](u,o);this._activeEffectsMap[l]=this._activeEffectsMap[l]||{},this._removeEffect(s,l),this._activeEffectsMap[l][s]=d,this._activeEffects.push({name:s,gameObjectId:l,effectApplicator:d})})}_processEffectsCancellation(e){(e.get(o)||[]).forEach(e=>{const{name:t,gameObject:s}=e;this._removeEffect(t,s.getId())})}_processRemovedGameObjects(){this._gameObjectObserver.getLastRemoved().forEach(e=>{const t=e.getId();Object.keys(this._activeEffectsMap[t]||{}).forEach(e=>{this._removeEffect(e,t)})})}process(e){const t=e.messageBus,s=e.deltaTime;this._processRemovedGameObjects(),this._processNewEffects(t),this._processEffectsCancellation(t),this._activeEffects=this._activeEffects.filter(e=>{const{name:t,gameObjectId:r,effectApplicator:i}=e;return i.update(s),!i.isFinished()||(this._activeEffectsMap[r][t].cancel(),this._activeEffectsMap[r][t]=null,!1)})}}},function(e,t,s){"use strict";s.r(t);var r=s(145),i=s(147),n=s(148),a=s(149),o=s(150);t.default={instant:r.default,delayed:i.default,periodical:n.default,continuous:a.default,timeLimited:o.default}},function(e,t,s){"use strict";s.r(t);var r=s(146);t.default=class extends r.default{constructor(e){super(),this._effect=e,this._isFinished=!1}update(){this._isFinished||(this._effect.apply(),this._isFinished=!0)}isFinished(){return this._isFinished}}},function(e,t,s){"use strict";s.r(t);t.default=class{update(){throw new Error("You should override this function")}isFinished(){throw new Error("You should override this function")}cancel(){}}},function(e,t,s){"use strict";s.r(t);var r=s(146);t.default=class extends r.default{constructor(e,t){super(),this._effect=e,this._isFinished=!1,this._timer=t.timer}update(e){this._isFinished||(this._timer-=e,this._timer<=0&&(this._effect.apply(),this._isFinished=!0))}isFinished(){return this._isFinished}}},function(e,t,s){"use strict";s.r(t);var r=s(146);t.default=class extends r.default{constructor(e,t){super(),this._effect=e,this._isFinished=!1,this._frequency=t.frequency,this._duration=t.duration,this._cooldown=this._frequency}update(e){if(!this._isFinished){for(this._cooldown-=e;this._cooldown<=0;)this._effect.apply(),this._cooldown+=this._frequency;this._duration&&(this._duration-=e,this._duration<=0&&(this._isFinished=!0))}}isFinished(){return this._isFinished}}},function(e,t,s){"use strict";s.r(t);var r=s(146);t.default=class extends r.default{constructor(e){super(),this._effect=e,this._isApplied=!1}update(){this._isApplied||(this._effect.apply(),this._isApplied=!0)}cancel(){this._isApplied&&this._effect.onCancel()}isFinished(){return!1}}},function(e,t,s){"use strict";s.r(t);var r=s(146);t.default=class extends r.default{constructor(e,t){super(),this._effect=e,this._duration=t.duration,this._isApplied=!1,this._isFinished=!1}update(e){this._isFinished||(this._duration-=e,this._duration<=0?this._isFinished=!0:this._isApplied||(this._effect.apply(),this._isApplied=!0))}cancel(){this._isApplied&&this._effect.onCancel()}isFinished(){return this._isFinished}}},function(e,t,s){"use strict";s.r(t);var r=s(152),i=s(154),n=s(155),a=s(156);t.default={damage:r.default,fetter:i.default,heal:n.default,power:a.default}},function(e,t,s){"use strict";s.r(t);var r=s(153);const i="DAMAGE";t.default=class extends r.default{constructor(e,t,s){super(),this._gameObject=e,this._messageBus=t,this._value=s.value}apply(){this._messageBus.send({type:i,id:this._gameObject.getId(),gameObject:this._gameObject,value:this._value})}}},function(e,t,s){"use strict";s.r(t);t.default=class{apply(){throw new Error("You should override this function")}onCancel(){}}},function(e,t,s){"use strict";s.r(t);var r=s(153);const i="movement";t.default=class extends r.default{constructor(e){super(),this._gameObject=e}apply(){const e=this._gameObject.getComponent(i);e&&(e.penalty+=e.speed)}onCancel(){const e=this._gameObject.getComponent(i);e&&(e.penalty-=e.speed)}}},function(e,t,s){"use strict";s.r(t);var r=s(153);const i="health";t.default=class extends r.default{constructor(e,t,s){super(),this._gameObject=e,this._value=s.value}apply(){const e=this._gameObject.getComponent(i);e&&(e.points+=this._value,e.points>e.maxPoints&&(e.points=e.maxPoints))}}},function(e,t,s){"use strict";s.r(t);var r=s(153);const i="meleeWeapon";t.default=class extends r.default{constructor(e,t,s){super(),this._gameObject=e,this._damage=s.damage,this._range=s.range}apply(){const e=this._gameObject.getComponent(i);e&&(e.damage+=this._damage,e.range+=this._range)}onCancel(){const e=this._gameObject.getComponent(i);e&&(e.damage-=this._damage,e.range-=this._range)}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(158);t.default=class extends r.ProcessorPlugin{async load(e){const{gameObjectObserver:t}=e;return new i.default({gameObjectObserver:t})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="keyboardControl",n="KILL",a="DEFEAT";t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._playerGameObjects=new Set,this._isGameOver=!1}_processAddedGameObjects(){this._gameObjectObserver.getLastAdded().forEach(e=>{const t=e.getId();e.getComponent(i)&&this._playerGameObjects.add(t)})}process(e){const t=e.messageBus;this._isGameOver||(this._processAddedGameObjects(),(t.get(n)||[]).forEach(e=>{const{gameObject:t}=e;this._playerGameObjects.delete(t.getId())}),0===this._playerGameObjects.size&&(t.send({type:a}),this._isGameOver=!0))}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(160);t.default=class extends r.ProcessorPlugin{async load(e){const{gameObjectObserver:t,gameObjectDestroyer:s,allowedComponents:r,lifetime:n}=e;return new i.default({gameObjectObserver:t,gameObjectDestroyer:s,allowedComponents:r,lifetime:n})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="KILL",n=1e3;t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._gameObjectDestroyer=e.gameObjectDestroyer,this._allowedComponents=e.allowedComponents.reduce((e,t)=>(e[t]=!0,e),{}),this._lifetime=e.lifetime,this._graveyard=[],this._timeCounter=0}_filterGameObjectComponents(e){e.getComponentNamesList().forEach(t=>{this._allowedComponents[t]||e.removeComponent(t)}),e.getChildren().forEach(e=>this._filterGameObjectComponents(e))}process(e){const{messageBus:t,deltaTime:s}=e;(t.get(i)||[]).forEach(e=>{const{gameObject:t}=e;this._filterGameObjectComponents(t),this._graveyard.push({gameObject:t,lifetime:this._lifetime})}),this._timeCounter+=s,this._timeCounter>=n&&(this._graveyard=this._graveyard.filter(e=>(e.lifetime-=this._timeCounter,!(e.lifetime<=0&&(this._gameObjectDestroyer.destroy(e.gameObject),1)))),this._timeCounter=0)}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(162);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({gameObjectSpawner:e.gameObjectSpawner,gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),r.forEach(function(t){n(e,t,s[t])})}return e}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const a="DAMAGE",o="COLLISION_ENTER",c="HIT",h="ADD_EFFECT",l="ADD_FORCE",u="pushPower",d="hit",_="transform",g="meleeWeapon",f="colliderContainer",m="health",p="hitBox",b=10,v=250,O=35e3,y=500,w={name:"lifetime",effect:"damage",effectType:"delayed",applicatorOptions:{timer:800}},E={name:"weaponFetter",effect:"fetter",effectType:"timeLimited"};t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._gameObjectSpawner=e.gameObjectSpawner,this._activeHits=[]}_pushTarget(e,t,s){s.send({type:l,name:u,value:t,duration:b,gameObject:e,id:e.getId()})}_processActiveHits(e){this._activeHits=this._activeHits.filter(t=>{const{player:s,hit:r,directionVector:n,damage:c}=t,l=r.getId();return(e.getById(o,l)||[]).forEach(t=>{const{gameObject2:r}=t,o=r.getComponent(p),u=r.getParent();if(!o||!u)return;const d=u.getId();s.getId()!==d&&l!==d&&(e.send({type:a,id:d,gameObject:u,value:c}),e.send(i({type:h,id:d,gameObject:u},E,{applicatorOptions:{duration:v}})),this._pushTarget(u,n.clone(),e))})})}_processWeaponsCooldown(e){this._gameObjectObserver.forEach(t=>{const s=t.getComponent(g);s.cooldownRemaining>0&&(s.cooldownRemaining-=e)})}_hit(e,t,s,n){const{offsetX:a,offsetY:o}=e.getComponent(_),l=e.getComponent(g);if(l.cooldownRemaining>0)return void n.deleteById(c,e.getId());const u=this._gameObjectSpawner.spawn(d),p=u.getComponent(_),b=u.getComponent(f).collider,v=u.getComponent(m);b.radius=l.range/2;const E=r.MathOps.getAngleBetweenTwoPoints(t,a,s,o),x=r.MathOps.getLinePoint(r.MathOps.radToDeg(E)+180,a,o,b.radius);p.offsetX=x.x,p.offsetY=x.y;const S=r.VectorOps.getVectorByAngle(E);S.multiplyNumber(O),n.send(i({type:h,id:u.getId(),gameObject:u},w,{applicatorOptions:{timer:y},effectOptions:{value:v.points}})),this._activeHits.push({player:e,hit:u,directionVector:S,damage:l.damage}),l.cooldownRemaining=l.cooldown}process(e){const{messageBus:t,deltaTime:s}=e;this._processActiveHits(t),this._processWeaponsCooldown(s),(t.get(c)||[]).forEach(e=>{const{gameObject:s,x:r,y:i}=e;this._hit(s,r,i,t)})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(164);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({gameObjectSpawner:e.gameObjectSpawner,gameObjectObserver:e.gameObjectObserver,store:e.store})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="DAMAGE",n="enemy",a="rangeEnemy",o="transform",c="meleeWeapon",h="weapon",l="health",u=2e3,d=4e3,_=0,g=9,f=1e4,m=2,p=5,b=4,v=2,O="timeOfDay";t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._gameObjectSpawner=e.gameObjectSpawner,this._store=e.store,this._islandSize={minX:-200,maxX:200,minY:-200,maxY:200},this._enemyCooldown=0,this._rangeEnemyCooldown=0}_spawnMeleeEnemies(e,t,s){if(this._enemyCooldown>0)this._enemyCooldown-=e;else if(t>=_&&t<g){const e=this._gameObjectSpawner.spawn(n),t=e.getComponent(o),i=e.getComponent(c),a=e.getComponent(l);i.damage+=s*m,a.maxPoints+=s*p,a.points+=s*p,t.offsetX=r.MathOps.random(this._islandSize.minX,this._islandSize.maxX),t.offsetY=r.MathOps.random(this._islandSize.minY,this._islandSize.maxY),this._enemyCooldown=u}}_spawnRangeEnemies(e,t,s){if(this._rangeEnemyCooldown>0)this._rangeEnemyCooldown-=e;else if(t>=_&&t<g){const e=this._gameObjectSpawner.spawn(a),t=e.getComponent(o),i=e.getComponent(h),n=e.getComponent(l);i.damage+=s*b,n.maxPoints+=s*v,n.points+=s*v,t.offsetX=r.MathOps.random(this._islandSize.minX,this._islandSize.maxX),t.offsetY=r.MathOps.random(this._islandSize.minY,this._islandSize.maxY),this._rangeEnemyCooldown=d}}process(e){const{messageBus:t,deltaTime:s}=e,r=this._store.get(O),n=r.getHours(),a=r.getDays()-1;this._spawnMeleeEnemies(s,n,a),this._spawnRangeEnemies(s,n,a),this._gameObjectObserver.size()&&n>=g&&this._gameObjectObserver.forEach(e=>{t.send({type:i,id:e.getId(),gameObject:e,value:f})})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(166);t.default=class extends r.ProcessorPlugin{async load(e){const{gameObjectObserver:t,store:s}=e;return new i.default({gameObjectObserver:t,store:s})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(167);const n="ai";t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._store=e.store,this.playersStrategies={}}_processAddedGameObjects(){this._gameObjectObserver.getLastAdded().forEach(e=>{const t=e.getId(),s=e.getComponent(n);this.playersStrategies[t]=new i.default[s.strategy](e,this._store)})}process(e){const{messageBus:t,deltaTime:s}=e;this._processAddedGameObjects(),this._gameObjectObserver.forEach(e=>{const r=e.getId();this.playersStrategies[r].update(t,s)})}}},function(e,t,s){"use strict";s.r(t);var r=s(168),i=s(170);t.default={enemy:r.default,rangeEnemy:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(169);const n="HIT",a="MOVEMENT",o="player",c="transform",h="meleeWeapon",l=1e3,u=20;t.default=class extends i.default{constructor(e,t){super(),this._player=e,this._store=t,this._playerId=this._player.getId(),this._cooldown=r.MathOps.random(0,l),this._distance=null,this._isMeleeEnemy=!1}_updateDistances(){const e=this._store.get(o);if(!e)return;const{offsetX:t,offsetY:s}=this._player.getComponent(c),{offsetX:i,offsetY:n}=e.getComponent(c);this._distance=r.MathOps.getDistanceBetweenTwoPoints(i,t,n,s)}_updateMeleeEnemies(){this._isMeleeEnemy=this._distance<=u}_attack(e){if(!this._isMeleeEnemy)return;if(this._player.getComponent(h).cooldownRemaining>0)return;const t=this._store.get(o);if(!t)return;const{offsetX:s,offsetY:r}=t.getComponent(c);e.send({gameObject:this._player,id:this._player.getId(),type:n,x:s,y:r})}_move(e){if(this._isMeleeEnemy)return;const t=this._store.get(o);if(!t)return;const{offsetX:s,offsetY:i}=t.getComponent(c),{offsetX:n,offsetY:h}=this._player.getComponent(c),l=r.MathOps.radToDeg(r.MathOps.getAngleBetweenTwoPoints(s,n,i,h));e.send({type:a,gameObject:this._player,id:this._player.getId(),directionAngle:l})}update(e,t){this._updateDistances(),this._updateMeleeEnemies(),this._attack(e),this._move(e)}}},function(e,t,s){"use strict";s.r(t);t.default=class{update(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(169);const n="SHOT",a="MOVEMENT",o="player",c="transform",h="weapon",l="colliderContainer",u=1e3,d=1,_=50,g=100;t.default=class extends i.default{constructor(e,t){super(),this._player=e,this._store=t,this._playerId=this._player.getId(),this._cooldown=r.MathOps.random(0,u),this._waypoint=null,this._enemy=null,this._meleeEnemy=null,this._distance=null,this._islandSize={minX:-200,maxX:200,minY:-200,maxY:200}}_getMovementBoundaries(){const{collider:e}=this._player.getComponent(l),{centerX:t,centerY:s}=e;return{minX:this._islandSize.minX-t,maxX:this._islandSize.maxX-t,minY:this._islandSize.minY-s,maxY:this._islandSize.maxY-s}}_updateDistances(){const e=this._store.get(o);if(!e)return;const{offsetX:t,offsetY:s}=this._player.getComponent(c),{offsetX:i,offsetY:n}=e.getComponent(c);this._distance=r.MathOps.getDistanceBetweenTwoPoints(i,t,n,s)}_updateMeleeEnemies(){const e=this._store.get(o);e&&(this._meleeEnemy=this._distance<=_?e:null)}_updateTargetEnemy(){this._store.get(o)?this._enemy=this._store.get(o):this._enemy=null}_findWayToRetreat(){let e;const{minX:t,maxX:s,minY:i,maxY:n}=this._getMovementBoundaries(),{offsetX:a,offsetY:h}=this._player.getComponent(c),l=this._store.get(o);if(!this._meleeEnemy||!l)return;const{offsetX:u,offsetY:d}=l.getComponent(c);e=(r.MathOps.radToDeg(r.MathOps.getAngleBetweenTwoPoints(a,u,h,d))+180)%360;const _=r.MathOps.getLinePoint(e,a,h,g);return _.x>t&&_.x<s&&_.y>i&&_.y<n?_:void 0}_updateWaypoint(){const{minX:e,maxX:t,minY:s,maxY:i}=this._getMovementBoundaries(),n=this._findWayToRetreat();this._waypoint=n||{x:r.MathOps.random(e,t),y:r.MathOps.random(s,i)}}_attack(e){const t=this._player.getComponent(h);if(t.cooldownRemaining>0||!this._enemy||t.range<this._distance)return;const{offsetX:s,offsetY:r}=this._enemy.getComponent(c);e.send({gameObject:this._player,id:this._player.getId(),type:n,x:s,y:r})}_move(e){if(!this._waypoint)return;const{offsetX:t,offsetY:s}=this._player.getComponent(c),{x:i,y:n}=this._waypoint;if(Math.abs(i-t)<d&&Math.abs(n-s)<d)return void(this._waypoint=null);const o=r.MathOps.radToDeg(r.MathOps.getAngleBetweenTwoPoints(this._waypoint.x,t,this._waypoint.y,s));e.send({type:a,gameObject:this._player,id:this._player.getId(),directionAngle:o})}update(e,t){this._cooldown-=t,this._cooldown<=0&&(this._updateDistances(),this._updateTargetEnemy(),this._updateWaypoint(),this._cooldown+=u),this._attack(e),this._move(e)}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(172);t.default=class extends r.ProcessorPlugin{async load(e){const{gameObjectObserver:t,store:s}=e;return new i.default({gameObjectObserver:t,store:s})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="keyboardControl",n="player";t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._store=e.store,this._playersCount=0}_scan(){this._playersCount=this._gameObjectObserver.size(),this._store.set(n,null),this._gameObjectObserver.forEach(e=>{e.getComponent(i)&&this._store.set(n,e)})}processorDidMount(){this._scan()}process(){this._playersCount!==this._gameObjectObserver.size()&&this._scan()}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(174);t.default=class extends r.ProcessorPlugin{async load(e){const t=r.IOC.resolve(r.RESOURCES_LOADER_KEY_NAME),{windowNodeId:s,textureAtlas:n,textureAtlasDescriptor:a,backgroundColor:o,sortingLayers:c,scaleSensitivity:h,gameObjectObserver:l,store:u}=e,d=document.getElementById(s),_=[n,a],g=await Promise.all(_.map(e=>t.load(e)));return new i.default({window:d,textureAtlas:g[0],textureAtlasDescriptor:g[1],backgroundColor:o,sortingLayers:c,scaleSensitivity:h,gameObjectObserver:l,store:u})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(175),n=s(176),a=s(181),o=s(185),c=s(188);const h=255,l=0,u=6,d=1080,_=2,g=Float32Array.BYTES_PER_ELEMENT*_,f=3,m=3*f,p=Float32Array.BYTES_PER_ELEMENT*m,b=Float32Array.BYTES_PER_ELEMENT*f,v=5*_+m,O=v*u,y=1e3*O*Float32Array.BYTES_PER_ELEMENT,w="renderable",E="transform",x="camera",S="currentCamera",C="SET_COLOR_FILTER";t.default=class extends r.Processor{constructor(e){super();const{window:t,textureAtlas:s,textureAtlasDescriptor:r,backgroundColor:i,gameObjectObserver:o,sortingLayers:h,store:l,scaleSensitivity:u}=e;this.textureAtlas=s,this.textureAtlasSize={width:this.textureAtlas.width,height:this.textureAtlas.height},this.textureAtlasDescriptor=r,this.textureHandlers=Object.keys(a.default).reduce((e,t)=>{const s=a.default[t];return e[t]=new s,e},{}),this._matrixTransformer=new c.default,this._backgroundColor=new n.default(i),this._view=t,this._viewWidth,this._viewHeight,this._windowDidResize=!0,this._onWindowResize=this._onWindowResize.bind(this),this._shaders=[],this._sortingLayer=h.reduce((e,t,s)=>(e[t]=s,e),{}),this._store=l,this._gameObjectObserver=o,this._scaleSensitivity=Math.min(Math.max(u,0),100)/100,this._screenScale=1,this._vaoExt=null,this._buffer=null,this._vao=null,this._geometry={},this._viewMatrixStats={},this._vertexData=null,this._gameObjectsCount=0}processorDidMount(){window.addEventListener("resize",this._onWindowResize),this.gl=this._initGraphicContext(),this._initExtensions(),this._initScreen(),this.program=this._initShaders(),this._initProgramInfo(),this.textures=this._initTextures()}processorWillUnmount(){window.removeEventListener("resize",this._onWindowResize),this._shaders.forEach(e=>{this.gl.detachShader(this.program,e),this.gl.deleteShader(e)}),this.gl.deleteProgram(this.program),this.gl.deleteTexture(this.textures),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this._buffer=null,this._shaders=[],this.program=null,this.textures=null,this.gl=null,this._vao=null,this._vaoExt=null,this._geometry={},this._viewMatrixStats={},this._vertexData=null,this._gameObjectsCount=0}_onWindowResize(){this._windowDidResize=!0}_initGraphicContext(){let e=null;try{e=this._view.getContext("webgl")||this._view.getContext("experimental-webgl")}catch(e){throw new Error("Unable to get graphic context.")}if(!e)throw new Error("Unable to initialize WebGL. Your browser may not support it.");return e}_initExtensions(){if(this._vaoExt=this.gl.getExtension("OES_vertex_array_object"),!this._vaoExt)return alert("Unable to initialize OES_vertex_array_object extension")}_initScreen(){this.gl.clearColor(this._backgroundColor.red()/h,this._backgroundColor.green()/h,this._backgroundColor.blue()/h,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.depthFunc(this.gl.LEQUAL),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}_initShaders(){const e=new o.default(this.gl),t=e.create(e.VERTEX_SHADER),s=e.create(e.FRAGMENT_SHADER),r=this.gl.createProgram();if(this.gl.attachShader(r,t),this.gl.attachShader(r,s),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error("Unable to initialize the shader program.");return this._shaders.push(t,s),r}_initProgramInfo(){this.gl.useProgram(this.program),this._variables={aPosition:this.gl.getAttribLocation(this.program,"a_position"),aTexCoord:this.gl.getAttribLocation(this.program,"a_texCoord"),aModelViewMatrix:this.gl.getAttribLocation(this.program,"a_modelViewMatrix"),aTexSize:this.gl.getAttribLocation(this.program,"a_texSize"),aTexTranslate:this.gl.getAttribLocation(this.program,"a_texTranslate"),aGameObjectSize:this.gl.getAttribLocation(this.program,"a_gameObjectSize"),uViewMatrix:this.gl.getUniformLocation(this.program,"u_viewMatrix"),uTexAtlasSize:this.gl.getUniformLocation(this.program,"u_texAtlasSize"),uColorFilterMatrix:this.gl.getUniformLocation(this.program,"u_colorFilterMatrix")},this._buffer=this.gl.createBuffer(),this._vao=this._createVAO(),this._setUpGlobalUniforms()}_createVAO(){const e=this._vaoExt.createVertexArrayOES();this._vaoExt.bindVertexArrayOES(e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,y,this.gl.DYNAMIC_DRAW);const t=[{loc:this._variables.aPosition,type:"vec2"},{loc:this._variables.aTexCoord,type:"vec2"},{loc:this._variables.aModelViewMatrix,type:"mat3"},{loc:this._variables.aTexSize,type:"vec2"},{loc:this._variables.aTexTranslate,type:"vec2"},{loc:this._variables.aGameObjectSize,type:"vec2"}],s={mat3:p,vec2:g},r=t.reduce((e,t)=>e+s[t.type],0);let i=0;for(let e=0;e<t.length;e++)if("vec2"===t[e].type)this.gl.enableVertexAttribArray(t[e].loc),this.gl.vertexAttribPointer(t[e].loc,_,this.gl.FLOAT,!1,r,i),i+=g;else if("mat3"===t[e].type){for(let s=0;s<f;s++){const n=t[e].loc+s;this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,f,this.gl.FLOAT,!1,r,i+s*b)}i+=p}return this._vaoExt.bindVertexArrayOES(null),e}_setUpGlobalUniforms(){this.gl.uniform2fv(this._variables.uTexAtlasSize,[this.textureAtlasSize.width,this.textureAtlasSize.height])}_initTextures(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.textureAtlas),e}_getModelViewMatrix(e,t,s,r){const i=this._matrixTransformer,n=i.getIdentityMatrix();return i.translate(n,e.origin[0],e.origin[1]),e.flipX&&i.flipX(n),e.flipY&&i.flipY(n),i.rotate(n,(e.rotation+r)%360),i.translate(n,t,s),n}_getCompareFunction(){return(e,t)=>{const s=e.getComponent(w),r=t.getComponent(w),i=this._sortingLayer[s.sortingLayer],n=this._sortingLayer[r.sortingLayer];if(i>n)return 1;if(i<n)return-1;const a=e.getComponent(E),o=t.getComponent(E),c=a.offsetY+s.height/2,h=o.offsetY+r.height/2;if(c>h)return 1;if(c<h)return-1;const l=a.offsetX+s.width/2,u=o.offsetX+r.width/2;return l>u?1:l<u?-1:0}}_setUpTextureInfo(e,t,s){this._vertexData[s]=e.width,this._vertexData[s+1]=e.height,this._vertexData[s+2]=e.x,this._vertexData[s+3]=e.y,this._vertexData[s+4]=t.width,this._vertexData[s+5]=t.height}_setUpMatrix(e,t){this._vertexData[t]=e[0],this._vertexData[t+1]=e[1],this._vertexData[t+2]=e[2],this._vertexData[t+3]=e[3],this._vertexData[t+4]=e[4],this._vertexData[t+5]=e[5],this._vertexData[t+6]=e[6],this._vertexData[t+7]=e[7],this._vertexData[t+8]=e[8]}_setUpVertexData(e,t){const s=e.getId(),r=e.getComponent(w),n=t*O;if(r.disabled){for(let e=0;e<O;e++)this._vertexData[n+e]=0;return}const a=e.getComponent(E),o=this.textureAtlasDescriptor[r.src],c=this.textureHandlers[r.type].handle(o,r),h=this._getModelViewMatrix(r,a.offsetX,a.offsetY,a.rotation);this._geometry[s]||(this._geometry[s]={position:new i.default(r.width,r.height).toArray(),texCoord:new i.default(c.width,c.height).toArray()});const l=this._geometry[s].position,u=this._geometry[s].texCoord;for(let e=0,t=n;e<l.length;e+=2,t+=v)this._vertexData[t]=l[e],this._vertexData[t+1]=l[e+1],this._vertexData[t+2]=u[e],this._vertexData[t+3]=u[e+1],this._setUpMatrix(h,t+2*_),this._setUpTextureInfo(c,r,t+2*_+m)}_resizeCanvas(e){if(!this._windowDidResize)return;const t=window.devicePixelRatio||1;this._viewWidth=this._view.clientWidth,this._viewHeight=this._view.clientHeight;const s=this._viewWidth*t,r=this._viewHeight*t;e.width=s,e.height=r;const i=Math.sqrt(Math.pow(e.clientWidth,2)+Math.pow(e.clientHeight,2)),n=1-this._scaleSensitivity,a=i-(i-d)*n;this._screenScale=a/d,this.gl.viewport(0,0,s,r),this._windowDidResize=!1}_updateViewMatrix(){const e=this._store.get(S),t=e.getComponent(E),{zoom:s}=e.getComponent(x),r=s*this._screenScale,i=this._viewMatrixStats;if(i.x===t.offsetX&&i.y===t.offsetY&&i.width===this._viewWidth&&i.height===this._viewHeight&&i.scale===r)return;const n=this._matrixTransformer,a=n.getIdentityMatrix();n.translate(a,-t.offsetX,-t.offsetY),n.scale(a,r,r),n.project(a,this._viewWidth,this._viewHeight),this.gl.uniformMatrix3fv(this._variables.uViewMatrix,!1,a),this._viewMatrixStats.width=this._viewWidth,this._viewMatrixStats.height=this._viewHeight,this._viewMatrixStats.x=t.offsetX,this._viewMatrixStats.y=t.offsetY,this._viewMatrixStats.scale=r}_allocateVertexData(){const e=this._gameObjectObserver.size();this._gameObjectsCount!==e&&(this._gameObjectsCount=e,this._vertexData=new Float32Array(this._gameObjectsCount*O))}_setUpBuffers(){this._vaoExt.bindVertexArrayOES(this._vao),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this._vertexData)}_processRemovedGameObjects(){this._gameObjectObserver.getLastRemoved().forEach(e=>{const t=e.getId();this._geometry[t]=null})}_processColorFilters(e){const t=e.get(C)||[];t.length&&this.gl.uniformMatrix4fv(this._variables.uColorFilterMatrix,!1,t[t.length-1].filter)}process(e){const{messageBus:t}=e,s=this.gl.canvas;this._resizeCanvas(s),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this._processRemovedGameObjects(),this._processColorFilters(t),this._updateViewMatrix(),this._allocateVertexData(),this._gameObjectObserver.sort(this._getCompareFunction()),this._gameObjectObserver.forEach((e,t)=>{this._setUpVertexData(e,t)}),this._setUpBuffers(),this.gl.drawArrays(this.gl.TRIANGLES,l,u*this._gameObjectObserver.size())}}},function(e,t,s){"use strict";s.r(t);t.default=class{constructor(e,t){this._width=e,this._height=t}toArray(){const e=0+this._width,t=0+this._height;return[0,0,e,0,0,t,0,t,e,0,e,t]}}},function(e,t,s){"use strict";s.r(t);var r=s(177);const i=/#[0-9a-zA-Z]{6}/,n=/#[0-9a-zA-Z]{3}/,a="red",o="green",c="blue";t.default=class{constructor(e){const t=[{regexp:i,reader:r.default.hexColorReader},{regexp:n,reader:r.default.shortHeColorReader}];if(this._color=void 0,t.some(t=>{if(e.match(t.regexp)){const s=t.reader;return this._color=(new s).read(e),!0}}),!this._color)throw new Error("Error while color initialization: unknown type of color presentation")}red(){return this._color[a]}green(){return this._color[o]}blue(){return this._color[c]}}},function(e,t,s){"use strict";s.r(t);var r=s(178),i=s(180);t.default={hexColorReader:r.default,shortHeColorReader:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(179);const i=8,n=16,a=255,o="#",c=["red","green","blue"];t.default=class extends r.default{read(e){const t=parseInt(e.replace(o,""),n);return c.reduce((e,s,r,n)=>(e[s]=t>>i*(n.length-r-1)&a,e),{})}}},function(e,t,s){"use strict";s.r(t);t.default=class{read(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(179);const i=16,n=2,a="#",o=["red","green","blue"];t.default=class extends r.default{read(e){return e=e.replace(a,""),o.reduce((t,s,r)=>(t[s]=parseInt(e[r].repeat(n),i),t),{})}}},function(e,t,s){"use strict";s.r(t);var r=s(182),i=s(184);t.default={static:r.default,sprite:i.default}},function(e,t,s){"use strict";s.r(t);var r=s(183);t.default=class extends r.default{handle(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}}},function(e,t,s){"use strict";s.r(t);t.default=class{handle(){throw new Error("You should override this function")}}},function(e,t,s){"use strict";s.r(t);var r=s(183);t.default=class extends r.default{handle(e,t){const{x:s,y:r,width:i,height:n}=e,{spacing:a,extruding:o,slice:c}=t,h=2*o,l=(i-(c-1)*a)/c-h,u=n-h;return{x:s+(l+a+h)*t.currentFrame+o,y:r+o,width:l,height:u}}}},function(e,t,s){"use strict";s.r(t);var r=s(186),i=s(187);const n="FRAGMENT_SHADER",a="VERTEX_SHADER",o={[n]:r.default,[a]:i.default};t.default=class{constructor(e){this.graphicContext=e,this.FRAGMENT_SHADER=n,this.VERTEX_SHADER=a,this.creators={[n]:this._createFragmentShader.bind(this),[a]:this._createVertexShader.bind(this)}}_createFragmentShader(){return this.graphicContext.createShader(this.graphicContext.FRAGMENT_SHADER)}_createVertexShader(){return this.graphicContext.createShader(this.graphicContext.VERTEX_SHADER)}create(e){const t=this.creators[e]();if(this.graphicContext.shaderSource(t,o[e]),this.graphicContext.compileShader(t),!this.graphicContext.getShaderParameter(t,this.graphicContext.COMPILE_STATUS)){const e=this.graphicContext.getShaderInfoLog(t);throw new Error(`An error occurred compiling the shaders: ${e}`)}return t}}},function(e,t,s){"use strict";s.r(t);t.default="\nprecision highp float;\n\nuniform sampler2D u_image;\nuniform vec2 u_texAtlasSize;\nuniform mat4 u_colorFilterMatrix;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_texSize;\nvarying vec2 v_texTranslate;\nvarying vec2 v_gameObjectSize;\n\nfloat calculateCoord(float gameObjectSize, float texSize, float texTranslate, float texCoord) {\n  if (gameObjectSize > texSize) {\n    float repeat = gameObjectSize / texSize;\n    return mod(texCoord * repeat, texSize) + texTranslate;\n  } else {\n    return texCoord + texTranslate;\n  }\n}\n\nvoid main() {\n  vec2 texCoord = vec2(\n    calculateCoord(v_gameObjectSize.x, v_texSize.x, v_texTranslate.x, v_texCoord.x),\n    calculateCoord(v_gameObjectSize.y, v_texSize.y, v_texTranslate.y, v_texCoord.y)\n  );\n\n  gl_FragColor = u_colorFilterMatrix * texture2D(u_image, texCoord / u_texAtlasSize);\n}\n"},function(e,t,s){"use strict";s.r(t);t.default="\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nattribute mat3 a_modelViewMatrix;\n\nattribute vec2 a_texSize;\nattribute vec2 a_texTranslate;\nattribute vec2 a_gameObjectSize;\n\nuniform mat3 u_viewMatrix;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_texSize;\nvarying vec2 v_texTranslate;\nvarying vec2 v_gameObjectSize;\n\nvoid main() {\n  mat3 matrix = u_viewMatrix * a_modelViewMatrix;\n  gl_Position = vec4((matrix * vec3(a_position, 1)).xy, 0, 1);\n\n  v_texCoord = a_texCoord;\n  v_texSize = a_texSize;\n  v_texTranslate = a_texTranslate;\n  v_gameObjectSize = a_gameObjectSize;\n}\n"},function(e,t,s){"use strict";s.r(t);t.default=class{getIdentityMatrix(){return[1,0,0,0,1,0,0,0,1]}project(e,t,s){const r=2/t,i=2/s;e[0]=e[0]*r,e[1]=-e[1]*i,e[3]=e[3]*r,e[4]=-e[4]*i,e[6]=e[6]*r,e[7]=-e[7]*i}translate(e,t,s){e[0]=e[0]+e[2]*t,e[1]=e[1]+e[2]*s,e[3]=e[3]+e[5]*t,e[4]=e[4]+e[5]*s,e[6]=e[6]+e[8]*t,e[7]=e[7]+e[8]*s}flipX(e){this.scale(e,-1,1)}flipY(e){this.scale(e,1,-1)}scale(e,t,s){e[0]=e[0]*t,e[1]=e[1]*s,e[3]=e[3]*t,e[4]=e[4]*s,e[6]=e[6]*t,e[7]=e[7]*s}rotate(e,t){t=t*Math.PI/180;const s=Math.cos(t),r=-Math.sin(t),i=e[0],n=e[3],a=e[6];e[0]=i*s+e[1]*r,e[1]=e[1]*s-i*r,e[3]=n*s+e[4]*r,e[4]=e[4]*s-n*r,e[6]=a*s+e[7]*r,e[7]=e[7]*s-a*r}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(190);t.default=class extends r.ProcessorPlugin{async load(e){const{store:t,dayLength:s,startTime:r}=e;return new i.default({store:t,dayLength:s,startTime:r})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(191);const n="timeOfDay",a="SET_COLOR_FILTER",o=[.4,0,.2,0,0,.4,.4,0,0,0,.4,0,0,0,0,1],c=[.5,0,0,0,0,.5,.4,0,0,0,.5,0,0,0,0,1],h=[.8,0,0,0,0,.8,0,0,0,0,.8,0,0,0,0,1],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[1,0,0,0,.3,1,0,0,0,0,.7,0,0,0,0,1],d=[.8,0,0,0,.5,.8,0,0,0,0,.7,0,0,0,0,1];t.default=class extends r.Processor{constructor(e){super(),this._dayLength=e.dayLength,this._startTime=e.startTime,this._store=e.store,this._time=null,this._schedule=[o,c,h,l,l,l,u,d],this._currentFilterIndex=null}processorDidMount(){this._time=new i.default(this._dayLength,this._startTime),this._store.set(n,this._time)}_updateColorFilter(e){const t=this._time.getHours();Math.floor(t/3)!==this._currentFilterIndex&&(this._currentFilterIndex=Math.floor(t/3),e.send({type:a,filter:this._schedule[this._currentFilterIndex]}))}process(e){const{messageBus:t,deltaTime:s}=e;this._time.tick(s),this._updateColorFilter(t)}}},function(e,t,s){"use strict";s.r(t);const r=864e5;t.default=class{constructor(e,t){this._dayLength=e,this._startTime=t,this._factor=r/this._dayLength,this._currentTime=this._startTime/this._factor,this._days=0}tick(e){this._currentTime=this._currentTime+e,this._currentTime>=this._dayLength&&(this._days+=1),this._currentTime=this._currentTime%this._dayLength}getTotalSeconds(){return this.getTotalMilliseconds()/1e3}getTotalMilliseconds(){return this._currentTime*this._factor}getDays(){return this._days}getHours(){return Math.floor(this.getTotalMilliseconds()/36e5)}getMinutes(){return Math.floor(this.getTotalMilliseconds()%36e5/6e4)}getSeconds(){return Math.floor(this.getTotalMilliseconds()%6e4/1e3)}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(193);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({gameObjectSpawner:e.gameObjectSpawner,gameObjectObserver:e.gameObjectObserver,store:e.store})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="transform",n="KILL",a=2e3,o=9,c=18,h=0,l=["healGrass","ogreGrass","boomGrass"],u="timeOfDay";t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._gameObjectSpawner=e.gameObjectSpawner,this._store=e.store,this._islandSize={minX:-180,maxX:180,minY:-180,maxY:180},this._cooldown=0}process(e){const{messageBus:t,deltaTime:s}=e;if(this._cooldown>0)return void(this._cooldown-=s);const d=this._store.get(u).getHours();if(d>=o&&d<c){const e=r.MathOps.random(0,l.length-1),t=this._gameObjectSpawner.spawn(l[e]).getComponent(i);t.offsetX=r.MathOps.random(this._islandSize.minX,this._islandSize.maxX),t.offsetY=r.MathOps.random(this._islandSize.minY,this._islandSize.maxY),this._cooldown=a}this._gameObjectObserver.size()&&d>=h&&d<o&&this._gameObjectObserver.forEach(e=>{t.send({type:n,id:e.getId(),gameObject:e})})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(195);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver,store:e.store})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="COLLISION_ENTER",n="COLLISION_LEAVE",a="GRAB",o="KILL",c="canGrab",h="inventory",l="collectable";t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._store=e.store,this._canGrab=new Set,this._inventory={}}processorDidMount(){this._store.set(c,this._canGrab),this._store.set(h,this._inventory)}process(e){const{messageBus:t}=e;this._gameObjectObserver.forEach(e=>{const s=e.getId();(t.getById(i,s)||[]).forEach(e=>{const{gameObject2:t}=e;t.getComponent(l)&&this._canGrab.add(t)}),(t.getById(n,s)||[]).forEach(e=>{const{gameObject2:t}=e;t.getComponent(l)&&this._canGrab.delete(t)}),(t.getById(a,s)||[]).forEach(()=>{if(!this._canGrab.size)return;const e=this._canGrab.values().next().value,s=e.getComponent(l);if(!s)return;const r=s.name;this._inventory[r]=this._inventory[r]||0,this._inventory[r]+=1,this._canGrab.delete(e),t.send({type:o,id:e.getId(),gameObject:e})})})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(197);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({store:e.store})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);const i="CRAFT_RECIPE",n="inventory";t.default=class extends r.Processor{constructor(e){super(),this._store=e.store}process(e){const{messageBus:t}=e;(t.get(i)||[]).forEach(e=>{const{recipe:t}=e,s=this._store.get(n);!s[t.resource]||s[t.resource]<t.cost||(s[t.resource]-=t.cost,s[t.name]=s[t.name]||0,s[t.name]+=1)})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(199);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({gameObjectObserver:e.gameObjectObserver,store:e.store})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const n="USE_ITEM",a="ADD_EFFECT",o="inventory",c={healPotion:{name:"heal",effect:"heal",effectType:"instant",effectOptions:{value:50}},powerPotion:{name:"power",effect:"power",effectType:"timeLimited",applicatorOptions:{duration:5e3},effectOptions:{damage:25,range:15}}};t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._store=e.store}process(e){const{messageBus:t}=e;this._gameObjectObserver.forEach(e=>{const s=e.getId();(t.getById(n,s)||[]).forEach(r=>{const{item:n}=r,h=this._store.get(o);h[n]&&(h[n]-=1,t.send(function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),r.forEach(function(t){i(e,t,s[t])})}return e}({type:a,id:s,gameObject:e},c[n])))})})}}},function(e,t,s){"use strict";s.r(t);var r=s(1),i=s(201);t.default=class extends r.ProcessorPlugin{async load(e){return new i.default({gameObjectSpawner:e.gameObjectSpawner,gameObjectObserver:e.gameObjectObserver})}}},function(e,t,s){"use strict";s.r(t);var r=s(1);function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),r.forEach(function(t){n(e,t,s[t])})}return e}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const a="DAMAGE",o="COLLISION_ENTER",c="SHOT",h="ADD_FORCE",l="ADD_EFFECT",u="shotPower",d="pushPower",_="transform",g="rigidBody",f="weapon",m="health",p="hitBox",b=10,v=b/1e3,O={name:"lifetime",effect:"damage",effectType:"delayed",applicatorOptions:{timer:800}},y={name:"weaponFetter",effect:"fetter",effectType:"timeLimited"};t.default=class extends r.Processor{constructor(e){super(),this._gameObjectObserver=e.gameObjectObserver,this._gameObjectSpawner=e.gameObjectSpawner,this._firedBullets=[]}_pushTarget(e,t,s){s.send({type:h,name:d,value:t,duration:b,gameObject:e,id:e.getId()})}_processFiredBullets(e){this._firedBullets=this._firedBullets.filter(t=>{const{shooter:s,bullet:r,directionVector:n,damage:c,fetterDuration:h}=t,u=r.getId();return(e.getById(o,u)||[]).every(t=>{const{gameObject2:o}=t,d=o.getComponent(p),_=o.getParent();if(!d||!_)return!0;const g=_.getId();if(s.getId()===g||u===g)return!0;const f=r.getComponent(m);return e.send({type:a,id:u,gameObject:r,value:f.points}),e.send({type:a,id:g,gameObject:_,value:c}),e.send(i({type:l,id:g,gameObject:_},y,{applicatorOptions:{duration:h}})),this._pushTarget(_,n,e),!1})})}_processWeaponsCooldown(e){this._gameObjectObserver.forEach(t=>{const s=t.getComponent(f);s.cooldownRemaining>0&&(s.cooldownRemaining-=e)})}_fire(e,t,s,n){const{offsetX:a,offsetY:o}=e.getComponent(_),d=e.getComponent(f);if(d.cooldownRemaining>0)return void n.deleteById(c,e.getId());const p=this._gameObjectSpawner.spawn(d.bullet),y=p.getComponent(_),w=p.getComponent(g),E=p.getComponent(m);y.offsetX=a,y.offsetY=o;const x=r.MathOps.getAngleBetweenTwoPoints(t,a,s,o);y.rotation=r.MathOps.radToDeg(x);const S=r.VectorOps.getVectorByAngle(x),C=d.speed*w.mass/v;S.multiplyNumber(C);const j=1e3*d.range/d.speed+b/2;n.send({type:h,name:u,value:S,duration:b,gameObject:p,id:p.getId()}),n.send(i({type:l,id:p.getId(),gameObject:p},O,{applicatorOptions:{timer:j},effectOptions:{value:E.points}})),this._firedBullets.push({shooter:e,bullet:p,directionVector:S.clone(),damage:d.damage,fetterDuration:d.fetterDuration}),d.cooldownRemaining=d.cooldown}process(e){const{messageBus:t,deltaTime:s}=e;this._processFiredBullets(t),this._processWeaponsCooldown(s),(t.get(c)||[]).forEach(e=>{const{gameObject:s,x:r,y:i}=e;this._fire(s,r,i,t)})}}},function(e,t,s){"use strict";s.r(t);var r=s(203),i=s(204),n=s(205),a=s(206),o=s(207),c=s(208);t.default={health:r.default,hitBox:i.default,meleeWeapon:n.default,ai:a.default,collectable:o.default,weapon:c.default}},function(e,t,s){"use strict";s.r(t);var r=s(1);class i extends r.Component{constructor(e){super(),this._points=e.points,this._maxPoints=e.points}set points(e){this._points=e}get points(){return this._points}set maxPoints(e){this._pmaxPoints=e}get maxPoints(){return this._maxPoints}clone(){return new i({points:this.points,maxPoints:this.maxPoints})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(1);class i extends r.Component{clone(){return new i}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(1);class i extends r.Component{constructor(e){super(),this._name=e.name,this._damage=e.damage,this._range=e.range,this._cooldown=e.cooldown,this._cooldownRemaining=0}set name(e){this._name=e}get name(){return this._name}set damage(e){this._damage=e}get damage(){return this._damage}set range(e){this._range=e}get range(){return this._range}set cooldown(e){this._cooldown=e}get cooldown(){return this._cooldown}set cooldownRemaining(e){this._cooldownRemaining=e}get cooldownRemaining(){return this._cooldownRemaining}clone(){return new i({name:this.name,damage:this.damage,range:this.range,cooldown:this.cooldown})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(1);class i extends r.Component{constructor(e){super(),this._strategy=e.strategy}set strategy(e){this._strategy=e}get strategy(){return this._strategy}clone(){return new i({strategy:this.strategy})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(1);class i extends r.Component{constructor(e){super(),this._name=e.name}set name(e){this._name=e}get name(){return this._name}clone(){return new i({name:this.name})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(1);class i extends r.Component{constructor(e){super(),this._name=e.name,this._bullet=e.bullet,this._damage=e.damage,this._fetterDuration=e.fetterDuration,this._speed=e.speed,this._range=e.range,this._cooldown=e.cooldown,this._cooldownRemaining=0}set name(e){this._name=e}get name(){return this._name}set bullet(e){this._bullet=e}get bullet(){return this._bullet}set damage(e){this._damage=e}get damage(){return this._damage}set fetterDuration(e){this._fetterDuration=e}get fetterDuration(){return this._fetterDuration}set speed(e){this._speed=e}get speed(){return this._speed}set range(e){this._range=e}get range(){return this._range}set cooldown(e){this._cooldown=e}get cooldown(){return this._cooldown}set cooldownRemaining(e){this._cooldownRemaining=e}get cooldownRemaining(){return this._cooldownRemaining}clone(){return new i({name:this.name,bullet:this.bullet,damage:this.damage,fetterDuration:this.fetterDuration,speed:this.speed,range:this.range,cooldown:this.cooldown})}}t.default=i},function(e,t,s){"use strict";s.r(t);var r=s(210),i=s(211);t.default={loadUiApp:r.default,loadScripts:i.default}},function(e,t,s){"use strict";function r(){return Promise.all([s.e(2),s.e(1)]).then(s.bind(null,212))}s.r(t),s.d(t,"default",function(){return r})},function(e,t,s){"use strict";function r(){return s.e(3).then(s.bind(null,282))}s.r(t),s.d(t,"default",function(){return r})}]);